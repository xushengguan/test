
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>支教老师个人中心</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>

    <style>
        .top_bg{padding: 0 15px 15px 15px; background: #ffb300; position: relative; height: 67px;}
        .pic{width: 63px; height: 63px; border: 2px solid #fff; border-radius: 2px; float: left;
        position: relative; margin-right: 15px;}
        .pic img{width: 100%; height: 100%;}
        .pic em{display: block; width: 12px; height: 15px; background: url(../image/ident.png) no-repeat center;
        background-size: contain; position: absolute; bottom: -3px; right: -7px;}
        .msg{width: 70%; float: left; }
        .msg .name{font-size: 17px; font-weight: bold; color: #fff; margin-bottom: 5px;}
        .msg .id{font-size: 14px; color: #ffeaba;}
        .nav{height: 60px; background: #fff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;
        margin-bottom: 7px; box-shadow: -2px 1px 2px rgba(0,0,0,.1);}
        .nav li{-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;background: url() no-repeat center 10px; background-size:24px;
        text-align: center; font-size: 13px; color: #999; padding-top: 36px;}
        .nav li.nav1{background: url(../image/nav1.png) no-repeat center 10px; background-size:24px;}
        .nav li.nav2{background: url(../image/nav2.png) no-repeat center 10px; background-size:24px;}
        .nav li.nav3{background: url(../image/nav3.png) no-repeat center 10px; background-size:24px;}

        .navMenu{background: #fff; box-shadow: 0 2px 5px #d4d4d4; border-radius: 3px;}
        .navMenu li{height: 50px; line-height: 50px; border-bottom: 1px solid #efeff4; padding-right: 15px; padding-left: 43px;
          background: url() no-repeat 15px center; font-size: 15px; color: #333; position: relative;}
        .navMenu li:last-child{border-bottom: none;}
        /*.navMenu li:nth-child(1){background: url(../image/menu1.png) no-repeat 15px center; background-size: 18px;}*/
        .navMenu li:nth-child(1){background: url(../image/menu2.png) no-repeat 15px center; background-size: 15px 19px;}
        .navMenu li:nth-child(2){background: url(../image/menu3.png) no-repeat 15px center; background-size: 17px 19px;}
        .navMenu li:nth-child(3){background: url(../image/menu4.png) no-repeat 15px center; background-size: 18px 14px;}
        .navMenu li:nth-child(4){background: url(../image/menu5.png) no-repeat 15px center; background-size: 18px;}
        .navMenu li em{display: block; width: 100px; height: 50px; background: url(../image/rt.png) no-repeat right center;
          background-size: 8px 15px; position: absolute; top: 0; right: 15px; text-align: right; padding-right: 18px; font-size: 15px;
        color: #999;}

        .top_bg .switch{display: block; width: 84px; height: 28px; background: url(../image/switch.png) no-repeat center;
        background-size: contain; position: absolute; bottom: 15px; right: 0;}
    </style>
</head>
<body>
    <header class="top_bg">
        <div class="pic">
            <img src="../image/pic3.png" alt="" id="img" onclick="viewPicture()">
            <em></em>
        </div>
        <div class="msg">
            <p class="name"></p>
            <p class="id"></p>
        </div>
        <span class="switch" onclick="exitLogin()"></span>
    </header>
    <ul class="nav">
        <li class="nav1" onclick="MyCircle()">我的动态</li>
        <li class="nav2" onclick="BillDetail()">账单明细</li>
        <li class="nav3" onclick="MyOrder()">我的订单</li>
    </ul>

    <ul class="navMenu" id="app">
        <!-- <li>成长记录<em></em></li> -->
        <li onclick="Address()">收货地址<em></em></li>
        <li onclick="Rating()">信用评级<em id="star"></em></li>
        <li onclick="goBindCard()">绑定银行卡<em class="isBind"></em></li>
        <li>规则与帮助<em></em></li>
    </ul>

</body>
</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/my.js"></script>
<script type="text/javascript">
var id,token,index;
apiready = function(){
  id = $api.getStorage('id');
  token = $api.getStorage('token');

  api.addEventListener({
      name: 'isBind'
  }, function(ret, err){
      if( ret.value.key ){
           getWidthDraw();
      }else{
           console.log( JSON.stringify( err ) );
      }
  });

  getUser();
  getStar();
  getWidthDraw();

  // 监听用户信息修改
  api.addEventListener({
      name: 'ExInfo'
  }, function(ret, err){
      if( ret ){

           getUser();
      }else{
           console.log( JSON.stringify( err ) );
      }
  });

}
    function getUser(){
        api.ajax({//获取用户基本信息
            url: serverurl,
            method: 'get',
            data: {
                values: {
                    type: '10035',
                     uid: id,
                   token: token
                },
            }
        },function(ret, err){

            if (ret.status == '1') {
              if (!ret.data.headimgurl) {
                  $api.attr($api.dom('#img'), 'src', '../image/pic3.png');
              }else {
                  $api.attr($api.dom('#img'), 'src', ret.data.headimgurl);
              }
              if (ret.data.nickname) {
                  $api.text($api.dom('.name'), ret.data.nickname);
              }else {
                  $api.text($api.dom('.name'), ret.data.tel);
              }

              $api.text($api.dom('.id'), 'ID:'+ret.data.id);
            }else {
                api.toast({
                    msg: '网络错误',
                    duration: 2000,
                    location: 'bottom'
                });

            }
        });
    }

    function getWidthDraw(){//用户银行卡列表
        api.ajax({
            url: serverurl,
            method: 'get',
            data: {
                values: {
                    type: '10128',
                   token:	token,
                     uid:id
                },
            }
        },function(ret, err){

            if (ret.data) {
                $api.text($api.dom('.isBind'), '已绑定');
                index = 1;
            }else{
                index = 2;
                $api.text($api.dom('.isBind'), '未绑定');
            }
        });

    }

  //查看信用星级
  function getStar(){
    api.ajax({
        url: serverurl,
        method: 'get',
        data: {
            values: {
                 type: '10157',
                 token:token,
                 uid:id
            },
        }
    },function(ret, err){
          if (ret) {
              $api.html($api.byId('star'), ret.credit+'星');
          }
    });
  };

// 我的学客圈
function MyCircle(){
    api.openWin({
        name: 'CircleIndex',
        url: './circle/CircleIndex.html',
        pageParam: {
            id: id
        }
    });

}

// 订单管理
function MyOrder(){
  api.openWin({
      name: 'order_title',
      url: './mall/order_title.html',
      pageParam: {
          name: 'test'
      }
  });
}

//信用评级
function Rating(){
    api.openWin({
        name: 'Rating_title',
        url: './setting/Rating_title.html',
        pageParam: {
            // name: 'test'
        }
    });
}

//收货地址
function Address(){
    api.openWin({
        name: '6address_title',
        url: './mall/6address_title.html',
        pageParam: {
            // name: 'test'
        }
    });
}

//账单明细
function BillDetail(){
    api.openWin({
        name: 'BillDetail',
        url: './setting/BillDetail_title.html',
        pageParam: {
            // name: 'test'
        }
    });
}

// 去绑定银行卡
function goBindCard(){
    if (index == 1) {//index-1已绑定，2-未绑定
        api.openWin({
            name: 'widthdraw',
            url: './MyBank/widthdraw.html',
            pageParam: {
                // name: 'test'
            },
            reload:true,
      			allowEdit:true
        });

    }else{
        api.openWin({
            name: 'BindBankCard',
            url: './MyBank/BindBankCard.html',
            pageParam: {
                // index: index
            },
            reload:true,
      			allowEdit:true
        });
    }
}

//退出登录
function exitLogin() {
  api.confirm({
      title: '切换身份提示',
      msg: '确定要切换身份吗？',
      buttons: ['确定', '取消']
  }, function(ret, err) {
      var index = ret.buttonIndex;
      if (index == 1) {
        api.ajax({
           url: serverurl,
           method: 'get',
           data: {
               values: {
                   type:'10039',
                   uid: id
               },
           }
       },function(ret, err){
           if (ret) {
               if (ret.status == '1') {
                 $api.clearStorage();//清除localStorage的所有数据，慎用
                
                 setTimeout(function(){
                   api.openWin({
                     name: 'login',
                     url: './login/login0.html',
                     reload:true,
               			allowEdit:true
                   });
                 },800);
               }
           } else {
               api.toast({
                   msg: '网络错误',
                   duration: 2000,
                   location: 'bottom'
               });
           }
       });
      }
  });
}

// 查看头像放大
function viewPicture(){
  var img = $api.attr($api.dom('#img'), 'src');
  if (img !== '../image/pic3.png') {
      var url = [];
      url.push($api.attr($api.dom('#img'), 'src'));
      var imageBrowser = api.require('imageBrowser');
      imageBrowser.openImages({
          imageUrls: url
      });
  }

}
</script>
