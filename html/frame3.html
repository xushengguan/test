<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>我</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <style>
          header{position: relative; height: 44px; line-height: 44px; box-shadow: 0px 4px 4px 0px rgba(76, 81, 118, 0.15);
          font-size: 18px; background-color: #fefefe; padding:0 14px; color: #232528; text-align: center;}
          header em{width: 18px; height: 44px; background: url(../image/setting.png) no-repeat center 12px; background-size: 18px 17px;
          padding-left: 14px; float: right;}

          .info{margin-top: 10px; background-color: #fefefe; padding: 14px; }
          .pic{width: 70px; height: 70px; overflow: hidden; border-radius: 50%;}
          .pic img{width: 100%; height: 100%;}
          .user-info{flex: 1; -webkit-flex:1; -webkit-box-flex:1; margin-left: 20px;}
          .user-info .user-nickname{font-size: 17px; color: #232528; font-weight: bold; margin-bottom: 12px;}
          .user-info .credit{background-color: #d6dbe2; padding: 4px 10px; text-align: center; border-radius: 12px;
            font-size: 15px; color: #fff;}
          .more{width: 10px; height: 16px; background: url(../image/more1.png) no-repeat center;
          background-size: 10px 16px; margin-left: 10px;}

          .act-box{margin-top: 10px; background-color: #fefefe; padding: 5px 0;}
          .act-lf{width: calc(75% - 28px); padding: 8px 14px;}
          .act-state{font-size: 14px; line-height: 20px; height: 20px;}
          .wait{background: url(../image/act1.png) no-repeat left 1px; background-size: 13px 16px; padding-left: 18px;
          color: #ffb608;}
          .underway{background: url(../image/act2.png) no-repeat left 2px; background-size: 15px; padding-left: 20px;
          color: #46daab;}
          .act-info{font-size: 15px;}
          .act-rt{border-left: 1px solid #e2e3e5; text-align: center; padding: 14px; width: calc(25% - 28px);}
          .act-rt span{width: 15px; height:13px; background: url(../image/menu1.png) no-repeat center;
          background-size: 15px 13px;}
          .my-act{font-size: 12px; color: #999; line-height: 20px; padding-top: 6px;}

          .menu-li{font-size: 16px; color: #232528; height: 50px; line-height: 50px; padding-right:14px;
           background-color: #fefefe; margin-top: 10px;}
          .menu-li.on{margin-top: 0; border-top: 1px solid #d2d3d5;}
          .menu1{background-image: url(../image/menu1.png); background-repeat: no-repeat; background-size: 15px 13px;
          background-position: 14px center; padding-left: 42px;}
          .menu2{background-image: url(../image/menu2.png); background-repeat: no-repeat; background-size: 15px;
          background-position: 14px center; padding-left: 42px;}
          .menu3{background-image: url(../image/menu3.png); background-repeat: no-repeat; background-size: 15px 16px;
          background-position: 14px center; padding-left: 42px;}
          .menu4{background-image: url(../image/menu4.png); background-repeat: no-repeat; background-size: 13px 15px;
          background-position: 14px center; padding-left: 40px;}
          .menu5{background-image: url(../image/menu5.png); background-repeat: no-repeat; background-size: 15px 13px;
          background-position: 14px center; padding-left: 42px;}
          .menu6{background-image: url(../image/menu6.png); background-repeat: no-repeat; background-size: 15px;
          background-position: 14px center; padding-left: 42px;}
      </style>
  </head>
  <body>
    <div id="wrap">
        <header>
          <!-- <span tapmode onclick="openWin('myBracelet','./mine/myBracelet.html','')">我的手环</span> -->
          我的
          <em tapmode onclick="openWin('7account','./mine/7account.html','')"></em>
        </header>
        <div id="main" v-cloak>
            <div class="info flex-align-center" tapmode onclick="openWin('MyAct','./mine/MyIndex.html','')">
                <div class="pic">
                    <img src="../image/pic.png" alt="人头像">
                </div>
                <div class="user-info">
                    <p class="user-nickname"></p>
                    <p><span class="credit" style="display:none"></span></p>
                </div>
                <div class="more"></div>
            </div>

            <div class="act-box flex-align-center" v-if="data">
                <!-- actsta活动状态.0已结束，1活动进行中，2活动未开始 -->
                <div class="act-lf" tapmode @click="ActDetail(data.id)" v-if="data.actsta == '1' || data.actsta == '2'">
                   <div class="act-state wait" v-show="data.actsta == '2'">等待开始</div>
                   <div class="act-state underway" v-show="data.actsta == '1'">正在进行</div>
                   <div class="act-info single">{{data.title}}</div>
                </div>

                <div class="act-rt">
                    <span></span>
                    <div class="my-act" tapmode onclick="openWin('MyAct','./mine/MyAct.html','')">我的活动</div>
                </div>
            </div>

            <div class="menu-li menu1" tapmode onclick="openWin('MyAct','./mine/MyAct.html','')" v-else>
                我的活动
            </div>
            <div class="menu-li menu2" tapmode onclick="openWin('myBracelet','./mine/myBracelet.html','')">
                我的手环
            </div>
            <div class="menu-li menu3" tapmode onclick="openWin('orderDetail','./mall/orderDetail.html','')">
                我的订单
            </div>
            <div class="menu-li menu4 on" tapmode onclick="openWin('6address_title','./mall/6address_title.html','')">
                收货地址
            </div>
            <div class="menu-li menu5" tapmode onclick="openWin('income','./mine/income.html','')">
                收支明细
            </div>
            <div class="menu-li menu6 on">
                信用评级
            </div>
        </div>

    </div>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript" src="../script/my.js"></script>
  <script type="text/javascript" src="../script/vue.js"></script>
  <script type="text/javascript">
      var token,id;
      apiready = function(){
    
          api.parseTapmode();//解析元素 tapmode 属性，优化点击事件处理
          token = api.getPrefs({
              sync: true,
              key: 'token'
          });
          id = api.getPrefs({
              sync: true,
              key: 'id'
          });
          getUser();
          vm.getAct();
          // 监听用户信息修改
          api.addEventListener({
              name: 'ExInfo'
          }, function(ret, err){
              if( ret ){
                   getUser();
              }else{
                   console.log( JSON.stringify( err ) );
              }
          });
    }

    var vm = new Vue({
        el:'#main',
        data:{
            data:[]
        },

        methods:{
            // 打开活动详情页
           ActDetail:function ActDetail(actid){
               openWin('actDetail','./active/actDetail.html',{actid:actid});
           },
           // 获取用户报名活动列表
           getAct:function getAct(){
               showProgress('努力加载中','请稍后···');
               api.ajax({
                   url: serverurl,
                   method: 'get',
                   data: {
                       values: {
                            type: '10028',
                             uid:id,
                           token: token
                       }
                   }
               },function(ret, err){
                   api.hideProgress();

                   if (ret) {

                       vm.data = ret[0];
                   } else {

                       msg('网络错误');
                   }
               });

           }
        }
    })

    function getUser(){

        api.ajax({//获取用户基本信息
            url: serverurl,
            method: 'get',
            cache:true,
            data: {
                values: {
                    type: '10035',
                     uid: id,
                   token: token
                },
            }
        },function(ret, err){

            if (ret) {
                if (ret.status == '5') {
                    ExitLogin();
                }else {
                    if (ret.data.headimgurl) {
                        $api.attr($api.dom('.pic img'), 'src', ret.data.headimgurl+'?x-oss-process=image/resize,m_fill,h_70,w_70');
                    }
                    $api.text($api.dom('.user-nickname'), ret.data.nickname);
                    $api.text($api.dom('.credit'), ret.data.winmoney+'学分');
                    $api.css($api.dom('.credit'),'display:inline-block');
                }
            }else {
                msg('网络错误');

            }
        });
    }


  </script>
  </html>
