<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>商品详情</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/loading.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/swiper.min.css">
      <style>
          header{height: 50px; line-height: 50px; background: #ffb300; color: #fff; font-size: 20px; position: relative;}
          header em{width: 50px; height: 50px; background: url(../../image/back.png) no-repeat center;
            background-size: 18px; float: left;}

          	.act_content {
          		background: #fff;
          		padding: 15px;
          		margin-bottom: 5px;
          	}

          	.act_content .title {
          		font-size: 15px;
          		line-height: 14px;

          	}

            .act_content .title .text{
          		font-size: 15px;
          		line-height: 14px;
              font-weight: bold;
          	}
          	/*==============边框===============*/

          	.act_content .title .before {
          		display: inline-block;
          		width: 8px;
          		height: 14px;
          		background: url(../../image/lines.png)no-repeat center;
          		background-size: 2px 10px;
          		vertical-align: middle;

          	}

          	/*==============边框===============*/

          	.act_content .box_main {
          		padding: 10px 10px 0 10px;
          	}

          	.act_content .role_box_main {
          		padding: 5px 10px 0 10px;

          	}
          	/*========================底部========================*/
          	/*学分不足*/

          	#nopay_footer {
          		width: 100%;
          		height: 55px;
          		line-height: 55px;
          		background: #fff;
          		overflow: hidden;
          		border-top: 1px solid #f2f2f2;

          	}

          	#nopay_footer .fo_left {
          		float: left;
          		width: 70%;
          	}

          	#nopay_footer .fo_left .lf_txt {
          		font-size: 14px;
          		color: #999;
          		padding-left: 25px;
          		padding-right: 2%;
          	}

          	#nopay_footer .fo_left .lf_txt em {
          		font-size: 18px;
          		color: #ffb300;
          	}

          	#nopay_footer .btn_pay {
          		float: right;
          		width: 30%;
          		height: 55px;
          		line-height: 55px;
          		text-align: center;
          		color: #fff;
          		font-size: 18px;
          		background: #ff5252;
          	}

          	#nopay_footer .btn_pay.submit {
          		background: #ffb300;
          	}
          	/*======================底部==========================*/
            .introduce{font-size: 14px;}
          	.introduce span{margin: 0 10px; color: #ffb300; font-size: 14px;}

            .swiper-container {
               width: 100%;
               height: 300px;
             }
             .swiper-slide {
               text-align: center;
               font-size: 18px;
               background: #fff;

               /* Center slide text vertically */
               display: -webkit-box;
               display: -ms-flexbox;
               display: -webkit-flex;
               display: flex;
               -webkit-box-pack: center;
               -ms-flex-pack: center;
               -webkit-justify-content: center;
               justify-content: center;
               -webkit-box-align: center;
               -ms-flex-align: center;
               -webkit-align-items: center;
               align-items: center;
             }

             .swiper-slide img{width: 100%; height: 100%; display: block;}
      </style>
  </head>
  <body>

      <div id="wrap" v-cloak>
        <header>
            <em tapmode onclick="go_back()"></em>
            商品详情
        </header>
    		<div id="main">

          <!-- Swiper -->
          <div class="swiper-container" v-if="img">
            <div class="swiper-wrapper">
              <div class="swiper-slide" v-for="v in img">
                  <img :src="v" alt="">
              </div>
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
          </div>

    			<div class="act_content">
    				<div class="title">
    					<span class="before"></span>
    					<span class="text">商品名称</span>
    				</div>
    				<div class="box_main">
    					<p class="introduce">
    						{{goodsInfo.goods_name}}
    						<span>库存:{{goodsInfo.goods_number}}</span>
    					</p>
    				</div>
    			</div>

    			<div class="act_content" v-if="goodsInfo.abs">
    				<div class="title">
    					<span class="before"></span>
    					<span class="text">商品介绍</span>
    				</div>
            <div class="box_main">
              <p class="introduce">
                {{goodsInfo.abs}}
              </p>
            </div>
    			</div>

    			<!-- 商品介绍 -->
    			<div class="act_content" v-if="content.content">
    				<div class="title">
    					<span class="before"></span>
    					<span class="text">商品详情</span>
    				</div>
    				<div class="box_main">
    					<p class="introduce" v-html="content.content">
    						<!-- {{content.content}} -->
    					</p>
    				</div>
    			</div>

    		</div>
        <!-- 底部 -->
    		<div id="nopay_footer">
    			<div class="fo_left">
    				<span class="lf_txt">单价：<em>{{goodsInfo.total}}学分</em></span>
    			</div>
    			<div class="btn_pay submit" tapmode @click="get_Defaddress()">提交订单</div>
    		</div>

    	</div>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/my.js"></script>
  <script type="text/javascript" src="../../script/vue.js"></script>
  <script type="text/javascript" src="../../script/swiper.min.js"></script>
  <script type="text/javascript">
      var header = $api.dom('header');
      fixStatusBar_API(header);

      var goodsid,role;
      apiready = function(){
            loading();
            fnInitSwipe();
            goodsid = api.pageParam.goods_id;
            role = $api.getStorage('role');

            vm.getGoodsInfo();
      };

      var vm = new Vue({
          el: '#wrap',
          data: {
              goodsInfo: [],
              content: [],
              img: []
          },
          methods: {
              get_Defaddress: function get_Defaddress() {
                  //读取收货地址列表(默认地址：is_default:'1')
                  var token = $api.getStorage('token');
                  var id = $api.getStorage('id');
                  api.ajax({
                      url: serverurl,
                      method: 'get',
                      cache: true,
                      dataType: 'json',
                      data: {
                          values: {
                              type: '10113',
                              token: token,
                              uid: id,
                              is_default: '1'
                          }
                      }
                  }, function (ret, err) {

                      if (ret) {
                          if (ret.status == '5') {
                              ExitLogin();
                          } else if (ret.status == '0') {
                              vm.go_address();
                          } else {
                              vm.PlaceOrder();
                          }
                      } else {
                          api.toast({
                              msg: '网络错误',
                              duration: 2000,
                              location: 'bottom'
                          });
                      }
                  });
              },
              getGoodsInfo: function getGoodsInfo() {
                  //读取商品详情

                  $api.css($api.byId('loading'), 'display:block');

                  vm.role = role;
                  api.ajax({
                      url: serverurl,
                      method: 'get',
                      cache: true,
                      dataType: 'json',
                      data: {
                          values: {
                              type: '10032',
                              goodsid: goodsid
                          }
                      }
                  }, function (ret, err) {
                      $api.css($api.byId('loading'), 'display:none');

                      if (ret) {
                          vm.goodsInfo = ret.data.info;
                          vm.content = ret.data.content;
                          vm.img = ret.data.img;
                      } else {
                          api.toast({
                              msg: '网络错误',
                              duration: 2000,
                              location: 'bottom'
                          });
                      }
                  });
              },
              PlaceOrder: function PlaceOrder() {
                  api.openWin({
                      name: '6confirmOrder',
                      url: './6confirmOrder.html',
                      pageParam: {
                          goods_id: goodsid
                      },
                      reload: true
                  });
              },


              //跳到地址页面
              go_address: function go_address() {

                api.openWin({
                    name: '6address2',
                    url: './6address2.html',
                    pageParam: {
                        goods_id:goodsid
                    },
                    reload:true
                });
              }
          }
      });

      // swiper
      function fnInitSwipe(){
        var swiper = new Swiper('.swiper-container', {
          pagination: {
            el: '.swiper-pagination',
          },
          centeredSlides: true,
          observer:true, //修改swiper自己或子元素时，自动初始化swiper
          observeParents:true,//修改swiper的父元素时，自动初始化swiper
          autoplay: {
            delay: 2500,
            disableOnInteraction: false,
          },

        });
      }
  </script>
  </html>
