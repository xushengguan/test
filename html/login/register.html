<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" href="../../css/api.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/rem.css">
    <link rel="stylesheet" href="../../icon/iconfonts/iconfont.css">
    <style>
        html {
            font-size: 625%;
        }

        .content {
            width: 100%;
            height: 100%;
            background: url(../../image/register_bg.jpg) no-repeat;
            background-size: cover;
            overflow: auto;
        }

        header {
            height: 0.5rem;
            line-height: 0.5rem;
        }

        .main {
            padding: 0 8.5%;
        }

        .box .title {
            font-size: 0.3rem;
            color: #7a530e;
        }

        .box .name {
            font-size: 0.39rem;
            color: #7a530e;
            font-weight: bold;
            padding-top: 0.03rem;
            padding-bottom: 0.2rem;
        }

        .form {
            background: #fff;
            width: 100%;
            border-radius: 5px;
            box-shadow: 0 0 5px #f4f4f4;
            overflow: hidden;
        }

        .form li {
            height: 0.42rem;
            line-height: 0.42rem;
            font-size: 0.15rem;
            border-bottom: 0.01rem solid #f2f2f2;
        }

        .form li .lf_name {
            width: 29%;
            text-align: center;
            color: #7a530e;
            float: left;
            height: 100%;
        }

        .form li .fr_prompt {
            color: #ccc;
            width: 69%;
            float: left;
            height: 100%;
            padding-right: 2%;
        }

         ::-webkit-input-placeholder {
            /* WebKit browsers */
            color: #ccc;
        }

        .btn_box {
            position: relative;
            padding-top: 0.4rem;
        }

        .error {
            width: 100%;
            position: absolute;
            top: 0.12rem;
            text-align: center;
            font-size: 0.13rem;
            color: #f43530;
        }

        .btn {
            width: 100%;
            height: 0.45rem;
            line-height: 0.45rem;
            text-align: center;
            border-radius: 5px;
            color: #fff;
            font-size: 0.15rem;
            background: #7a530e;
            box-shadow: 0 0 10px rgba(0, 0, 0, .1);
        }

        .btn.on,.btn:active {
            background: #ab8b51;
        }

        .agreement {
            font-size: 0.12rem;
            text-align: center;
            color: #7a530e;
            position: relative;
            margin-top: 0.15rem;
        }

        .agreement a {
            text-decoration: underline;
            color: #212121;
        }

        .back {
            padding: 0.3rem 0;
            text-align: center;
            font-size: 0.14rem;
            color: #7a530e;
        }

        .back a {
            text-decoration: underline;
            color: #4c5be5;
        }
    </style>
</head>

<body>
    <div class="content">
        <header>
            <i class="iconfont icon-fanhui" style="font-size: 0.3rem; color: #000;position: absolute;top: 0.05rem; left: 0.02rem;" onclick="go_back()"></i>
        </header>
        <div class="main">
            <!-- 学生家长注册 -->
            <div class="box" id="studentParent" style="display:none;">
                <div class="title">Sign Up</div>
                <div class="name">学生家长注册</div>
                <form action="">
                    <ul class="form">
                        <li>
                            <span class="lf_name">学生姓名</span>
                            <input type="text" class="fr_prompt studentName" placeholder="学生的名称">
                        </li>
                        <li>
                            <span class="lf_name">家长姓名</span>
                            <input type="text" class="fr_prompt parentName" placeholder="家长的名称">
                        </li>
                        <li>
                            <span class="lf_name">联系电话</span>
                            <input type="text" class="fr_prompt tel1" placeholder="常用联系电话">
                        </li>
                        <li>
                            <span class="lf_name">验 证 码</span>
                            <input type="text" class="fr_prompt code1" placeholder="输入验证码" style="width: 40%;">
                            <input type="button" class="lf_name" value="获取验证码" onclick="getCode(this)">
                        </li>
                        <li>
                            <span class="lf_name">设置密码</span>
                            <input type="password" class="fr_prompt setPassword1" placeholder="6-20位字母,特殊符号或数字">
                        </li>
                        <li>
                            <span class="lf_name">确认密码</span>
                            <input type="password" class="fr_prompt confirmPassword1" placeholder="确认您的密码">
                        </li>
                    </ul>
                    <div class="btn_box">
                        <div class="error"  id="error1" style="display:none">
                            <i class="iconfont icon-jingshi" style="position: absolute; top: 0.01rem; margin-left: -0.2rem;"></i>
                            <span id="prompt1">两次密码输入不一致</span>
                        </div>
                    </div>
                    <div class="btn" id="btn1" onclick="SP_register()">注 册</div>

                </form>
            </div>

            <!-- 班主任注册 -->
            <div class="box" id="headmaster" style="display:none">
                <div class="title">Sign Up</div>
                <div class="name">班主任注册</div>
                <form action="">
                    <ul class="form">
                        <li>
                            <span class="lf_name">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名</span>
                            <input type="text" class="fr_prompt MyName" placeholder="您的名称">
                        </li>
                        <li>
                            <span class="lf_name">学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;校</span>
                            <input type="text" class="fr_prompt Myschool" placeholder="学校的名称">
                        </li>
                        <li>
                            <span class="lf_name">联系电话</span>
                            <input type="text" class="fr_prompt tel2" placeholder="常用联系电话">
                        </li>
                        <li>
                            <span class="lf_name">验 证 码</span>
                            <input type="text" class="fr_prompt code2" placeholder="输入验证码" style="width: 40%;">
                            <input type="button" class="lf_name" value="获取验证码" onclick="getCode(this)">
                        </li>
                        <li>
                            <span class="lf_name">设置密码</span>
                            <input type="password" class="fr_prompt setPassword2" placeholder="6-20位字母,特殊符号或数字">
                        </li>
                        <li>
                            <span class="lf_name">确认密码</span>
                            <input type="password" class="fr_prompt confirmPassword2" placeholder="确认您的密码">
                        </li>
                    </ul>
                    <div class="btn_box">
                        <div class="error"  id="error2" style="display:none">
                            <i class="iconfont icon-jingshi" style="position: absolute; top: 0.01rem; margin-left: -0.2rem;"></i>
                            <span id="prompt2">两次密码输入不一致</span>
                        </div>
                    </div>
                    <div class="btn" id="btn2" onclick="headmaster_register()">注 册</div>

                </form>
            </div>

            <!-- 合作商注册 -->
            <div class="box" id="co_operative" style="display:none">
                <div class="title">Sign Up</div>
                <div class="name">合作商注册</div>
                <form action="">
                    <ul class="form">
                        <li>
                            <span class="lf_name">企业名称</span>
                            <input type="text" class="fr_prompt enterName" placeholder="您的企业名称">
                        </li>
                        <li>
                            <span class="lf_name">企业法人</span>
                            <input type="text" class="fr_prompt personName" placeholder="企业法人名称">
                        </li>
                        <li>
                            <span class="lf_name">法人电话</span>
                            <input type="text" class="fr_prompt tel3" placeholder="法人联系电话">
                        </li>
                        <li>
                            <span class="lf_name">验 证 码</span>
                            <input type="text" class="fr_prompt code3" placeholder="输入验证码" style="width: 40%;">
                            <input type="button" class="lf_name" value="获取验证码" onclick="getCode(this)">
                        </li>
                        <li>
                            <span class="lf_name">设置密码</span>
                            <input type="password" class="fr_prompt setPassword3" placeholder="6-20位字母,符号或数字组成">
                        </li>
                        <li>
                            <span class="lf_name">确认密码</span>
                            <input type="password" class="fr_prompt confirmPassword3" placeholder="确认您的密码">
                        </li>
                    </ul>
                    <div class="btn_box">
                        <div class="error" id="error3" style="display:none">
                            <i class="iconfont icon-jingshi" style="position: absolute; top: 0.01rem; margin-left: -0.2rem;"></i>
                            <span id="prompt3">两次密码输入不一致</span>
                        </div>
                    </div>
                    <div class="btn" id="btn3" onclick="business_res()">注 册</div>

                </form>
            </div>

            <div class="agreement">
                <!-- 点击勾选增加calss icon-gouxuanE-->
                    <i class="iconfont icon-gouxuan1 icon-gouxuanE" style="font-size: 0.25rem; position: absolute; top: -0.04rem; margin-left: -0.35rem;" onclick="agree()"></i>
                 我已认真阅读并同意该
                <a href="javascript:;">用户协议</a>
            </div>
            <div class="back">
                已有账号
                <a href="javascript:;" onclick="goLogin()">返回登录</a>
            </div>
        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/my.js"></script>
<script type="text/javascript">
    var index;//定义全局变量
    apiready = function() {
        index = api.pageParam.index; //获取上个页面的传参
        //根据上个页面的传参分别进入相应的角色注册
        switch (index) {
            case 1:
                $api.css($api.dom('#studentParent'), 'display:block');
                break;
            case 2:
                $api.css($api.dom('#headmaster'), 'display:block');
                break;
            case 3:
                $api.css($api.dom('#co_operative'), 'display:block');
                break;
            default:
        };

    }

    //注册成功
    function registerGo() {
        api.openWin({
            name: 'index',
            url: '../../index.html',
            pageParam: {
                name: 'test'
            }
        });

    }

    //商家注册
    function business_res() {
        var enterName = $api.val($api.dom('.enterName')); //企业名称
        var personName = $api.val($api.dom('.personName')); //企业法人
        var code = $api.val($api.dom('.code3')); //验证码
        var tel = $api.val($api.dom('.tel3')); //联系电话
        var setPassword = $api.val($api.dom('.setPassword3')); //设置密码
        var confirmPassword = $api.val($api.dom('.confirmPassword3')); //确认密码
        var myreg = /^1[0-9]{10}$/; //验证手机号码正则表达式,/^1[34578]\d{9}$/
        var mypassword = /^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,20}$/;//6-20位字母,符号或数字组成
        if ($api.hasCls($api.dom('#btn3'), 'on')) {
            return false;
        }
        if (enterName == '') {
            Tips('#error3','企业名称不能为空！');
            return false;
        } else if (personName == '') {
            Tips('#error3','企业法人名称不能为空！');
            return false;
        } else if (!myreg.test(tel)) {
            Tips('#error3','请输入有效的手机号码！');
            return false;
        }else if (code == '') {
            Tips('#error3','请输入验证码！');
            return false;
        }else if (!mypassword.test(setPassword)) {
            Tips('#error3','请输入正确的密码！');
            return false;
        }else if (confirmPassword !== setPassword) {
            Tips('#error3','两次密码输入不一致！');
            return false;
        }
        api.ajax({
            url: serverurl,
            method: 'post',
            dataType:'json',
            data: {
                values: {
                    type: '10002',
                    company_name: enterName,
                    legal_person: personName,
                    tel:tel,
                    pwd:confirmPassword,
                    role:3,
                    code:code
                }
            }
        },function(ret, err){
            if (ret) {

                switch (ret.status) {
                  case '1':
                    $api.toast('注册成功', '',  2000);
                    goLogin();
                    break;
                  case '2':
                    api.toast({
                        msg: '该号码已经注册',
                        duration: 2000,
                        location: 'middle'
                    });
                    break;
                  case '0':
                    api.toast({
                        msg: '注册失败',
                        duration: 2000,
                        location: 'middle'
                    });
                    break;
                case '4':
                  api.toast({
                      msg: '验证码不正确',
                      duration: 2000,
                      location: 'middle'
                  });
                  break;
                  default:

                }
            } else {
                api.toast({
                    msg: '网络错误',
                    duration: 2000,
                    location: 'bottom'
                });
            }
        });

    }

    //学生家长注册
    function SP_register(){
      var studentName = $api.val($api.dom('.studentName')); //学生名称
      var parentName = $api.val($api.dom('.parentName')); //家长名称
      var code = $api.val($api.dom('.code1')); //验证码
      var tel = $api.val($api.dom('.tel1')); //联系电话
      var setPassword = $api.val($api.dom('.setPassword1')); //设置密码
      var confirmPassword = $api.val($api.dom('.confirmPassword1')); //确认密码
      var myreg = /^1[0-9]{10}$/; //验证手机号码正则表达式,/^1[34578]\d{9}$/
      var mypassword = /^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,20}$/;//6-20位字母,符号或数字组成
      if ($api.hasCls($api.dom('#btn1'), 'on')) {
          return false;
      }
      if (studentName == '') {
          Tips('#error1','学生名称不能为空！');
          return false;
      } else if (parentName == '') {
          Tips('#error1','家长名称不能为空！');
          return false;
      } else if (!myreg.test(tel)) {
          Tips('#error1','请输入有效的手机号码！');
          return false;
      }else if (code == '') {
          Tips('#error1','请输入验证码！');
          return false;
      }else if (!mypassword.test(setPassword)) {
          Tips('#error1','请输入正确的密码！');
          return false;
      }else if (confirmPassword !== setPassword) {
          Tips('#error1','两次密码输入不一致！');
          return false;
      }

      api.ajax({
          url: serverurl,
          method: 'post',
          dataType:'json',
          data: {
              values: {
                  type: '10000',
                  stu_name: studentName,
                  par_name: parentName,
                  tel:tel,
                  pwd:confirmPassword,
                  role:1,
                  code:code
              }
          }
      },function(ret, err){

          if (ret) {
              switch (ret.status) {
                case '1':
                  $api.toast('注册成功', '',  2000);
                  goLogin();
                  break;
                case '2':
                  api.toast({
                      msg: '该号码已经注册',
                      duration: 2000,
                      location: 'middle'
                  });
                  break;
                case '0':
                  api.toast({
                      msg: '注册失败',
                      duration: 2000,
                      location: 'middle'
                  });
                  break;
                case '4':
                  api.toast({
                      msg: '验证码不正确',
                      duration: 2000,
                      location: 'middle'
                  });
                  break;
                default:

              }
          } else {
              api.toast({
                  msg: '网络错误',
                  duration: 2000,
                  location: 'bottom'
              });
          }
      });

    }

    //班主任注册
    function headmaster_register(){
      var MyName = $api.val($api.dom('.MyName')); //我的名称
      var Myschool = $api.val($api.dom('.Myschool')); //学校名称
      var code = $api.val($api.dom('.code2')); //验证码
      var tel = $api.val($api.dom('.tel2')); //联系电话
      var setPassword = $api.val($api.dom('.setPassword2')); //设置密码
      var confirmPassword = $api.val($api.dom('.confirmPassword2')); //确认密码
      var myreg = /^1[0-9]{10}$/; //验证手机号码正则表达式,/^1[34578]\d{9}$/
      var mypassword = /^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,20}$/;//6-20位字母,符号或数字组成
      if ($api.hasCls($api.dom('#btn2'), 'on')) {
          return false;
      }
      if (MyName == '') {
          Tips('#error2','请输入您的姓名！');
          return false;
      } else if (Myschool == '') {
          Tips('#error2','学校名称不能为空！');
          return false;
      } else if (!myreg.test(tel)) {
          Tips('#error2','请输入有效的手机号码！');
          return false;
      }else if (code == '') {
          Tips('#error2','请输入验证码！');
          return false;
      }else if (!mypassword.test(setPassword)) {
          Tips('#error2','请输入正确的密码！');
          return false;
      }else if (confirmPassword !== setPassword) {
          Tips('#error2','两次密码输入不一致！');
          return false;
      };
      api.ajax({
          url: serverurl,
          method: 'post',
          dataType:'json',
          data: {
              values: {
                  type: '10001',
                  tea_name: MyName,
                  school: Myschool,
                  tel:tel,
                  pwd:confirmPassword,
                  role:2,
                  code:code
              }
          }
      },function(ret, err){
          if (ret) {
              switch (ret.status) {
                case '1':
                  $api.toast('注册成功', '',  2000);
                  goLogin();
                  break;
                case '2':
                  api.toast({
                      msg: '该号码已经注册',
                      duration: 2000,
                      location: 'middle'
                  });
                  break;
                case '0':
                  api.toast({
                      msg: '注册失败',
                      duration: 2000,
                      location: 'middle'
                  });
                  break;
                case '4':
                  api.toast({
                      msg: '验证码不正确',
                      duration: 2000,
                      location: 'middle'
                  });
                  break;
                default:

              }
          } else {
              api.toast({
                  msg: '网络错误',
                  duration: 2000,
                  location: 'bottom'
              });
          }
      });
    }

    //返回到登录页
    function goLogin() {
        api.openWin({
            name: '1login',
            url: './1login.html',
            pageParam: {
                name: 'test'
            }
        });
    }

    //获取验证码
    var wait = 60;
    function getCode(obj) {
        var tel = $api.val($api.dom('.tel' + index)); //联系电话
        var myreg = /^1[0-9]{10}$/; //验证手机号码正则表达式,/^1[34578]\d{9}$/
        if (!myreg.test(tel)) {
            $api.css($api.dom('#error' + index), 'display:block');
            $api.text($api.dom('#prompt' + index), '请输入有效的手机号码！');
            setTimeout(function(){$api.css($api.dom('#error' + index),'display:none');}, 1000);
            return false;
        }else{
            SendCode(obj,tel,wait);//获取手机验证码
       };
    }

    //同意用户协议勾选
    function agree(){
        if ($api.hasCls($api.dom('.icon-gouxuan1'), 'icon-gouxuanE')) {
            $api.removeCls($api.dom('.icon-gouxuan1'), 'icon-gouxuanE');
            $api.addCls($api.dom('#btn' + index), 'on');
        }else{
            $api.addCls($api.dom('.icon-gouxuan1'), 'icon-gouxuanE');
            $api.removeCls($api.dom('#btn' + index), 'on');
        };
    }

    //错误提示
    function Tips(el,txt){
        $api.css($api.dom(el), 'display:block');
        $api.text($api.dom(el+' '+'span'), txt);
        setTimeout(function(){$api.css($api.dom(el),'display:none');}, 1000);
    }
</script>
