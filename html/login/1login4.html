<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" href="../../css/api.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../icon/iconfonts/iconfont.css">
    <link rel="stylesheet" href="../../css/1login4.css">
</head>

<body>
    <!-- 找回密码 -->
    <div class="login4 login2" id="find">
        <header class="login4-header">
            <i class="iconfont icon-fanhui icon-back" onclick="go_back()"></i>
            <span class="pwd01">Retrieve Password</span>
            <span class="pwd02">找回密码</span>
        </header>
        <div class="login-con">
            <div class="table-con">
                <div class="phone-num" style="border-bottom:1px solid #e3e3e3">
                    <span>电话</span>
                    <span><input type="text" placeholder="请输入手机号码" id="FindTel"></span>
                </div>
                <div class="phone-code hide" style="border-bottom:1px solid #e3e3e3">
                    <span class="fl">验证码</span>
                    <span class="fl"><input type="text" placeholder="请输入验证码" id="FindCode"></span>
                    <!-- <span class="get-code fr" onclick="getCode(this)">获取验证码</span> -->
                    <input type="button" class="get-code fr" value="获取验证码" onclick="getCode(this)">
                </div>
                <div class="phone-num" style="border-bottom:1px solid #e3e3e3">
                    <span style="padding-right:17px; width:60px;">新密码</span>
                    <input style="width: calc(100% - 65px);" type="password" placeholder="请输入密码" id="NewPwd">
                </div>
                <div class="phone-num">
                    <span style="padding-right:17px;">确认密码</span>
                    <input style="width: calc(100% - 77px);" type="password" placeholder="请确认的密码" id="confirmPwd">
                </div>
            </div>
            <p class="wrong-con" id="FindError" style="position:relative; display:none;">
                <i class="iconfont icon-jingshi icon-warn"></i>
                <span class="wrong-num">验证码有误</span>
            </p>
            <div class="login4-btns">
                <button class="login-btn" onclick="set_sure()">确定</button>
            </div>
        </div>
    </div>

    <!--  设置密码 -->
    <!-- <div class="login4 login2" id="setting" style="display:none">
        <header class="login4-header">
            <i class="iconfont icon-fanhui icon-back"></i>
            <span class="pwd01">Set Password</span>
            <span class="pwd02">设置密码</span>
        </header>
        <div class="login-con">
            <div class="table-con">
                <div class="phone-num" style="border-bottom:1px solid #e3e3e3">
                    <span style="width:35%;padding-right:0;">新密码</span>
                    <span style="width:60%; "><input type="password" placeholder="6-20位字母,符号或数字组成" id="NewPwd"></span>
                </div>
                <div class="phone-num">
                    <span style="width:35%;padding-right:0;">确认密码</span>
                    <span style="width:60%; "><input type="password" placeholder="确认您的密码" id="confirmPwd"></span>
                </div>
            </div>
            <p class="wrong-con " id="SetError" style="display:none">
                <i class="iconfont icon-jingshi icon-warn "></i>
                <span class="wrong-num ">验证码有误</span>
            </p>
            <div class="login4-btns ">
                <button class="login-btn" onclick="set_sure()">确定</button>
            </div>
        </div>
    </div> -->
</body>

</html>
<script type="text/javascript " src="../../script/api.js "></script>
<script type="text/javascript" src="../../script/my.js"></script>
<script type="text/javascript ">
     apiready = function(){

     }

     //找回密码确定
     var myreg = /^1[0-9]{10}$/;//判断是否为手机号码,/^1[34578]\d{9}$/
     var mypassword = /^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,20}$/;//6-20位字母,符号或数字组成


     //获取验证码
     var wait = 60;
     function getCode(obj) {
         var tel = $api.val($api.dom('#FindTel'));
         if (!myreg.test(tel)) {
             Tips('#FindError','#FindError .wrong-num','请输入有效的手机号码！');
             return false;
         }else{
             SendCode(obj,tel,wait);//获取手机验证码
        };
     }

    //  function find_sure(){
    //      tel = $api.val($api.dom('#FindTel'));
    //      code = $api.val($api.dom('#FindCode'));
    //      if (!myreg.test(tel)) {
    //           Tips('#FindError','#FindError .wrong-num','请输入有效的手机号码！');
    //           return false;
    //      }
     //
    //      if (code == '') {
    //           Tips('#FindError','#FindError .wrong-num','请输入验证码！');
    //           return false;
    //      }
    //      $api.css($api.dom("#find"), "display:none");
    //      $api.css($api.dom("#setting"), "display:block");
    //  }

     //设置密码确定
     function set_sure(){
         var tel = $api.val($api.dom('#FindTel'));
         var code = $api.val($api.dom('#FindCode'));
         var pwd = $api.val($api.dom('#NewPwd'));
         var confirmPwd = $api.val($api.dom('#confirmPwd'));
         if (!myreg.test(tel)) {
              Tips('#FindError','#FindError .wrong-num','请输入有效的手机号码！');
              return false;
         }else if (code == '') {
              Tips('#FindError','#FindError .wrong-num','请输入验证码！');
              return false;
         }else if (!mypassword.test(pwd)) {
            //  Tips('#SetError','#SetError .wrong-num','请输入6-20位字母,符号或数字组成的密码！');
             Tips('#FindError','#FindError .wrong-num','请输入6-20位字母,符号或数字组成的密码！');
             return false;
         }else if (confirmPwd !== pwd) {
            //  Tips('#SetError','#SetError .wrong-num','两次密码输入不一致！');
             Tips('#FindError','#FindError .wrong-num','两次密码输入不一致！');
             return false;
         }
         api.ajax({//修改用户密码
             url: serverurl,
             method: 'post',
             dataType: 'json',
             data: {
                 values: {
                     type: '10009',
                     tel: tel,
                     pwd:pwd,
                     code:code
                 }
             }
         }, function(ret, err) {
  
             if (ret) {
                 if (ret.status == '1') {//成功
                    api.toast({
                        msg: '修改成功',
                        duration: 2000,
                        location: 'middle'
                    });
                    api.openWin({
                        name: '1login',
                        url: './1login.html',
                        pageParam: {
                            name: 'test'
                        }
                    });

                 }else if (ret.status == '2') {
                   api.toast({
                       msg: '验证码不正确',
                       duration: 2000,
                       location: 'middle'
                   });
                 }else{
                   api.toast({
                       msg: '修改失败',
                       duration: 2000,
                       location: 'middle'
                   });
                 }
             } else {
                 api.toast({
                     msg: '网络错误',
                     duration: 2000,
                     location: 'bottom'
                 });

             }
        });


     }

     //错误提示
     function Tips(el,eltxt,txt){
         $api.css($api.dom(el),'display:block');
         $api.text($api.dom(eltxt),txt);
         setTimeout(function(){$api.css($api.dom(el),'display:none');},1000);
     }
</script>
