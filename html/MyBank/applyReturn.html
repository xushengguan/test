<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>申请退款</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <style>
      header {
          height: 50px;
          line-height: 50px;
          background: #ffb300;
          color: #fff;
          font-size: 18px;
          position: relative;
          box-shadow: 0px 2px 6px 0px rgba(0, 0, 0, 0.25);
      }

      header em {
          width: 50px;
          height: 50px;
          background: url(../../image/back.png) no-repeat center;
          background-size: 20px;
          float: left;
      }

      header span{float: right; margin-right: 15px;}

      .line{height: 50px; line-height: 50px; font-size: 15px; color: #333; border-bottom: 1px solid #f2f2f2; overflow: hidden;
      background: #fff;}
      .line span{display: block; width: 75px; float: left; padding-left: 15px; text-align: left;}
      .line input{width: calc(100% - 105px); float: left; height: 50px; padding-right: 15px;}
      #content{background: #fff; padding: 15px; box-shadow: 0px 1px 0px 0px #d8d8d8; height: 146px;
        width: calc(100% - 30px); resize: none; font-size: 15px; color: #ccc;}
      </style>
  </head>
  <body>
    <div id="wrap">
      <header>
          <em onclick="go_back()"></em>
          申请退款
          <span onclick="Submit()">提交</span>
      </header>
      <div id="main">
          <div class="line">
              <span>姓名</span>
              <input class="nickname" type="text">
          </div>
          <div class="line">
              <span>电话号码</span>
              <input class="tel" type="text">
          </div>
          <textarea name="" id="content" cols="30" rows="10" placeholder="请填写退货原因"></textarea>
      </div>
    </div>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/my.js"></script>
  <script type="text/javascript">
      var header = $api.dom('header');
      fixStatusBar_API(header);
      apiready = function(){

      };

      // 产品申请退款
      function Submit(){
          var key = api.pageParam.key;
          var token = $api.getStorage('token');
          var uid = $api.getStorage('id');
          var name = $api.val($api.dom('.nickname'));
          var tel = $api.val($api.dom('.tel'));
          var content = $api.val($api.dom('#content'));
          var myreg = /^1[0-9]{10}$/;//判断是否为手机号码
          if (!name) {
              api.toast({
                  msg: '请填写您的姓名',
                  duration: 2000,
                  location: 'middle'
              });
              return false;
          }else if (!myreg.test(tel)) {
              api.toast({
                  msg: '请填写正确的手机号码',
                  duration: 2000,
                  location: 'middle'
              });
              return false;
          }else if (!content) {
              api.toast({
                  msg: '请填写退货原因，以便为您审核通过退款',
                  duration: 2000,
                  location: 'middle'
              });
              return false;
          }else{
              api.ajax({
                  url: serverurl,
                  method: 'get',
                  data: {
                      values: {
                          type: '10145',
                          uid:uid,
                          token:token,
                           key: key,
                           name:name,
                           tel:tel,
                        content: content
                      },
                  }
              },function(ret, err){
                  if (ret) {

                      if (ret.status == '1') {
                          api.alert({
                              title: '退款通知',
                              msg: '提交成功，我们将会在几天内以短信形式通知您处理结果',
                              buttons:["我知道了"]
                          }, function(ret, err){
                              if( ret ){

                                   go_back();
                              }else{
                                   console.log( JSON.stringify( err ) );
                              }
                          });

                      }else {
                          api.toast({
                              msg: '申请退款失败',
                              duration: 2000,
                              location: 'bottom'
                          });
                      }
                  } else {
                      console.log( JSON.stringify( err ) );
                      api.toast({
                          msg: '网络错误',
                          duration: 2000,
                          location: 'bottom'
                      });
                  }
              });

          }
      }
  </script>
  </html>
