<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>搜索</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/loading.css"/>
      <style>
          header{background: #ffb300;}
          .input_box {
              padding: 5px 10px;
              position: relative;
              /*background: #ffb300;*/
              overflow: hidden;
          }
          .input_box .bg{background: #fff; overflow: hidden; border-radius: 2px;}
          .input_box input {
              width: calc(100% - 55px);
              height: 40px;
              line-height: 40px;
              background: #fff;
              color: #ccc;
              font-size: 16px;
              padding-left: 15px;
              display: block;
              float: left;
              text-align: left;
          }

          .input_box em {
              display: block;
              width: 40px;
              height: 40px;
              background: url(../../image/search.png) no-repeat center;
              background-size: 16px;
              background-color: #fff;
              float: left;
          }

          .user{background: #fff; margin-bottom: 15px;}
          .title{padding: 15px 10px; color: #999; font-size: 14px; border-bottom: 1px solid #f2f2f2;}

          #swipe {
              position: relative;
              overflow: hidden;
              visibility: hidden;
              background-color: #fff;
          }

          .swipe-wrap {
              overflow: hidden;
              padding-bottom: 24px;
          }

          .swipe-page {
              float: left;
              width: 100%;
              position: relative;
          }

          .swipe-page-item {
              float: left;
              width: 20%;
              text-align: center;
          }

          .swipe-page-item>img {
              width: 50px;
              height:50px;
              margin-top: 10px;
              border-radius: 50%;
          }

          .swipe-page-item>span {
              display: block;
              font-size: 13px;
              margin-top: 5px;
          }

          #swipeIndicator {
              position: absolute;
              left: 50%;
              bottom: 0px;
              -webkit-transform: translateX(-50%);
              transform: translateX(-50%);
          }

          #swipeIndicator li {
              height: 24px;
              line-height: 24px;
              width: 16px;
              float: left;
              background: url(../image/swipe/indicator.png) no-repeat center center;
              background-color: transparent;
              background-size: 8px 8px;
          }

          #swipeIndicator li.active {
              background: url(../image/swipe/indicator_act.png) no-repeat center center;
              background-color: transparent;
              background-size: 8px 8px;
          }
          /* swipe end. */

          .activity{background: #fff;}
          .ActLis li{padding: 15px 10px; display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;
          -webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center; border-bottom: 1px solid #f2f2f2;}
          .ActLis li img{width:50px; height: 50px; border-radius: 2px;}
          .ActLis li .rt{margin-left: 15px; width: calc(100% - 65px);}
          .act_title{color: #333; font-size: 14px; line-height: 25px;}
          .ActLis li .time{color: #999; font-size: 13px; line-height: 25px;}

          .noMsg{font-size: 16px; text-align: center; padding: 20px;}
      </style>
  </head>
  <body>
      <div id="wrap" v-cloak>
          <header>
            <div class="input_box">
                <div class="bg">
                  <input type="text" placeholder="请输入您想要搜索的内容" id="text">
                  <em @click="search()"></em>
                </div>
            </div>
          </header>
          <div id="main">
              <div class="noMsg" v-if="act == '' && user == ''">暂无相关内容~</div>

              <div class="contentMsg" v-else>
                  <div class="user" v-if="user">
                      <div class="title">相关用户</div>
                      <!-- swipe begin -->
                      <section id="swipe" class="section01">
                          <div class="swipe-wrap">
                              <div class="swipe-page">
                                  <div class="swipe-page-row">
                                      <div class="swipe-page-item open-win" v-for="(v,index) in user" v-if="index < count" @click="goCircel(v.uid)">
                                          <img :src="v.headimgurl+'?x-oss-process=image/resize,p_50'" v-if="v.headimgurl">
                                          <img src="../../image/pic3.png" v-else>
                                          <span class="single">{{v.nickname}}</span>
                                      </div>
                                      <div class="swipe-page-item open-win" id="showAll" @click="shoeAll()" v-if="count == 4">
                                          <img src="../../image/more1.png">
                                          <span>更多</span>
                                      </div>
                                  </div>
                              </div>
                          </div>
                    </section>
                    <!-- swipe end -->
                  </div>
                  <div class="activity" v-if="act">
                      <div class="title">相关活动</div>
                      <ul class="ActLis">
                          <li v-for="v in act" @click="goActDetail(v.act_id)">
                              <img :src="v.actimgurl+'?x-oss-process=image/resize,p_50'" alt="">
                              <div class="rt">
                                  <p class="act_title single">{{v.title}}</p>
                                  <p class="time">活动时间：{{v.time | formatDate}}</p>
                              </div>
                          </li>
                      </ul>
                  </div>

              </div>
          </div>
      </div>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/my.js"></script>
  <script type="text/javascript" src="../../script/vue.js"></script>
  <script type="text/javascript" src="../../script/date.js"></script>
  <script type="text/javascript" src="../../script/swipe.js"></script>
  <script type="text/javascript">
  fnInitSwipe();
  var header = $api.dom('header');
  fixStatusBar_API(header);
      apiready = function(){
          loading();
          var text = api.pageParam.text;
          if (text) {
              $api.val($api.byId('text'),text);
              vm.search();
          }
      };

      function fnInitSwipe() {
          var swipe = $api.byId('swipe');

          new Swipe(swipe, {
              callback: function(index) {}
          });
      };

      var vm = new Vue({
          el:'#wrap',
          data:{
              act:[],
              user:[],
              count:''
          },
          filters: {
              formatDate(time) {
                  var date = new Date(time * 1000);
                  return formatDate(date, 'yyyy年MM月dd日');
              }
          },
          methods:{
            search(){// 用户搜索
                var text = $api.val($api.byId('text'));
                var token = $api.getStorage('token');

                if (!text) {
                    api.toast({
                        msg: '请输入搜索内容',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return false;
                }else{
                    $api.css($api.dom('#loading'),'display:block');
                    api.ajax({
                        url: serverurl,
                        method: 'get',
                        data: {
                            values: {
                                type: '10140',
                                token: token,
                                 name:text
                            },
                        }
                    },function(ret, err){
                        $api.css($api.dom('#loading'),'display:none');
                        console.log(JSON.stringify(ret));
                        console.log(JSON.stringify(err));
                        if (ret) {
                            vm.user = ret.user;
                            vm.act = ret.act;
                             console.log(JSON.stringify(vm.user));
                            vm.count = 4;
                        } else {

                            api.toast({
                                msg: '网络错误',
                                duration: 2000,
                                location: 'bottom'
                            });

                        }
                    });
              }
            },

            goActDetail(actid){
                api.openWin({
                    name: 'ActDetail',
                    url: '../activity/ActDetail.html',
                    pageParam: {
                        actid: actid
                    }
                });

            },

            shoeAll(){
                this.count = this.user.length;
            },

            goCircel(id){
                api.openWin({
                    name: 'CircleIndex',
                    url: '../circle/CircleIndex.html',
                    pageParam: {
                        id: id
                    }
                });
            }

          }
      })

  </script>
  </html>
