<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>产品激活</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/loading.css"/>
      <style>
          .content{padding: 15px;}
          .content .box{background: #fff; border-radius: 5px;}
          .content .box .top{padding: 22px;}
          .top .title{font-size: 16px; color: #999; line-height: 25px;}
          .top .title em{display: block; float: right; width: 19px; height: 24px; background: url(../../image/ident.png) no-repeat center;
          background-size: contain;}
          .top .num{color: #212121; font-size: 13px; margin-top: 10px;}
          .top .num em{font-size: 30px; font-weight: bold;}
          .box .line{height: 15px; position: relative; padding: 0 25px; display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;
          -webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;}
          .box .line .line1{width: 100%; height: 0; border-bottom: 2px dashed #f2f2f2;}
          .box .line em{display: block; width: 8px; height: 16px; background: #f2f2f2;position: absolute; top: 0; z-index: 99;}
          .box .line .lf{ border-radius: 0 8px 8px 0; left: 0;}
          .box .line .rt{ border-radius: 8px 0 0 8px; right: 0;}
          .Lis li{padding: 15px; border-bottom: 1px solid #dfe1e8;}
          .Lis li .title{font-size: 13px; color: #999; padding-bottom: 16px;}
          .container{overflow: hidden;}
          .container .txt{font-size: 15px; color: #212121; font-weight: bold; float: left; width: 70%; word-wrap: break-word; word-break: break-all;}
          .container span{font-size: 13px; color: #16378b; float: right;}
          .noStu{text-align: center; font-size: 16px; color: #212121; padding: 20px;}
      </style>
  </head>
  <body>
    <div class="content" id="app" v-cloak>
        <div class="box">
          <div class="top">
            <div class="title">当前已激活<em></em></div>
            <div class="num" v-if="status == '0'"><em>0</em>套</div>
            <div class="num" v-else><em>{{count}}</em>套</div>
          </div>
          <div class="line">
              <div class="line1"></div>
              <em class="lf"></em>
              <em class="rt"></em>
          </div>
          <div class="noStu" v-if="status == '0'">暂无激活的产品</div>
          <ul class="Lis" v-else>
            <li v-for="v in Info">
                <p class="title">{{v.time | formatDate}}</p>
                <div class="container">
                    <p class="txt">学令牌ID-{{v.key}}</p>
                    <span style="color:#ffb300;" v-if="v.status == '3'">处理中</span>
                    <span style="color:#006400;" v-else-if="v.status == '1'">同意退款</span>
                    <span style="color:#B22222;" v-else-if="v.status == '2'">不允许退款</span>
                    <span tapmode @click="applyReturn(v.key)" v-else>申请退款>></span>
                </div>
            </li>
          </ul>
        </div>
    </div>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/my.js"></script>
  <script type="text/javascript" src="../../script/vue.js"></script>
  <script type="text/javascript" src="../../script/date.js"></script>
  <script type="text/javascript">
  var token,uid;
  apiready = function(){
      loading();
      token = $api.getStorage('token');
      uid = $api.getStorage('id');
      vm.actProduct();

      //刷新
      api.setRefreshHeaderInfo({
          loadingImg: 'widget://image/refresh.png',
          bgColor: '#444',
          textColor: '#fff',
          textUp: '释放立即刷新...',
          textLoading: '加载中···',
          showTime: false
      }, function(ret, err) {
          //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
          vm.actProduct();
          api.refreshHeaderLoadDone();
      });
  }

  var vm = new Vue({
      el:'#app',
      data:{
          Info:[],
          count:'',
          status:''
      },
      filters: {
          formatDate(time) {
              var date = new Date(time * 1000);
              return formatDate(date, 'yyyy-MM-dd');
          }
      },
      methods:{
          actProduct(){//激活产品列表
              $api.css($api.byId('loading'),'display:block');
              api.ajax({
                  url: serverurl,
                  method: 'get',
                  data: {
                      values: {
                          type: '10144',
                          token: token,
                          uid:uid,
                      },
                  }
              },function(ret, err){

                  $api.css($api.byId('loading'),'display:none');

                  if (ret) {
                      if (ret.status == '5') {
                          ExitLogin();
                      }else if(ret.status == '0'){
                          vm.status = ret.status;
                      }else{
                        vm.Info = ret.data;//status0:处理中 1:同意退款 2:不允许退款    为空时申请退款
                        vm.count = ret.count;
                      }

                  } else {

                      api.toast({
                          msg: '网络错误',
                          duration: 2000,
                          location: 'bottom'
                      });

                  }
              });
          },

          applyReturn(key){
              api.openWin({
                  name: 'applyReturn',
                  url: '../MyBank/applyReturn.html',
                  pageParam: {
                      key: key
                  },
                  reload:true
              });
          },

      }
  })
  </script>
  </html>
