<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>产品激活</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <style>
      header {
          height: 50px;
          line-height: 50px;
          background: #ffb300;
          color: #fff;
          font-size: 18px;
          position: relative;
          box-shadow: 0px 2px 6px 0px rgba(0, 0, 0, 0.25);
      }

      header em {
          width: 50px;
          height: 50px;
          background: url(../../image/back.png) no-repeat center;
          background-size: 20px;
          float: left;
      }

      header span{
          font-size: 18px;
          color: #fff;
          float: right;
          margin-right: 18px;
          height: 50px;
          line-height: 50px;
      }
      </style>
  </head>
  <body>
    <header>
        <em tapmode onclick="go_back()"></em>
        产品激活
        <span tapmode onclick="scan()">扫码激活</span>
    </header>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/my.js"></script>
  <script type="text/javascript">
      var header = $api.dom('header');
      fixStatusBar_API(header);
      apiready = function(){
          api.openFrame({
              name: 'activeProduct',
              url: './activeProduct.html',
              rect: {
                  x: 0,
                  y: $api.dom('header').offsetHeight,
                  w: api.winWidth,
                  h: 'auto'
              },
              reload:true,
              bounces: true,
              bgColor: 'rgba(0,0,0,0)',
              vScrollBarEnabled: true,
              hScrollBarEnabled: true
          });

      };

      // 扫描二维码
      function scan(){
        var FNScanner = api.require('FNScanner');
        FNScanner.openScanner({
            autorotation: true
        }, function(ret, err) {
            if (ret) {
                if (ret.eventType == 'success') {

                    ActProduct(ret.content);
                }else if (ret.eventType == 'fail') {
                    api.toast({
                        msg: '扫描失败',
                        duration: 2000,
                        location: 'middle'
                    });

                }
            } else {
                api.toast({
                    msg: err,
                    duration: 2000,
                    location: 'bottom'
                });
            }
        });
      }

      // 产品激活
      function ActProduct(key){

          var uid = $api.getStorage('id');
          var token = $api.getStorage('token');
          api.ajax({
              url: serverurl,
              method: 'get',
              data: {
                  values: {
                       type: '10147',
                       uid:uid,
                      token: token,
                       key: key
                  },
              }
          },function(ret, err){

              if (ret) {

                  if (ret.status == '1') {
                     api.toast({
                         msg: '激活成功',
                         duration: 2000,
                         location: 'middle'
                     });
                     window.location.reload();
                  }else if (ret.status == '3') {
                      api.toast({
                          msg: '产品不存在',
                          duration: 2000,
                          location: 'middle'
                      });
                  }else{
                      api.toast({
                          msg: '激活失败',
                          duration: 2000,
                          location: 'middle'
                      });

                  }
              } else {

                  api.toast({
                      msg: '网络错误',
                      duration: 2000,
                      location: 'bottom'
                  });

              }
          });

      }
  </script>
  </html>
