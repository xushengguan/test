<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>首页</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../css/loading.css"/>
      <style>
          header{background: #ffb300; padding: 15px; }
          .info{padding-bottom: 20px; display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;
          -webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;}
          .info img{width: 26px; height: 26px; border-radius: 50%;}
          .info span{font-size: 15px; color: #fff; padding-left: 10px; padding-right: 5px;}
          .info em{width: 12px; height: 26px; background: url(../image/ident.png) no-repeat center; background-size: contain;}
          .assets{font-size: 14px; color: #fff1cf; padding-bottom: 14px;}
          .money{overflow: hidden; margin-bottom: 18px; display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;
          -webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;}
          .money .num{font-size: 18px; color: #ffebbf; width: 70%; float: left;}
          .money .num em{font-size: 29px; font-weight: bold; color: #fff; }
          .money button{display: block; position: absolute; right: 15px; width: 75px; height: 25px; border-radius: 25px; border: 2px solid #ffd876;
            background-color: #ffcc4e; color: #fff; font-size: 14px;}
          .menu{width: 100%; overflow: hidden;}
          .menu li{float: left; position: relative; width: 50%; margin-top: 18px;}
          .menu li .menu_title{font-size: 13px; color: #fff1cf; line-height: 14px;}
          .menu li .num{font-size: 15px; color: #fff; line-height: 14px; padding-top: 5px;}
          .menu li em{position: absolute; right: 23px; top: 50%; transform: translateY(-50%); background: url(../image/rt.png) no-repeat center;
          background-size: 6px 10px; width: 6px; height: 10px;}

          .nav{background: #fff; display: -webkit-flex; display: -webkit-box; display: flex; padding: 5px 0;
          box-shadow: 0 2px 4px 0 rgba(0,0,0,0.15); margin-bottom: 8px;}
          .nav li{flex: 1; -webkit-box-flex:1; -webkit-flex:1; border-right: 1px solid #f2f2f2; padding-top: 56px; padding-bottom: 14px;
          background: url() no-repeat center 20px; background-size: auto 23px; text-align: center; font-size: 15px; color: #000;}
          .nav li:nth-child(1){background: url(../image/nav_bar1.png) no-repeat center 20px; background-size: auto 23px;}
          .nav li:nth-child(2){background: url(../image/nav_bar2.png) no-repeat center 20px; background-size: auto 23px;}
          .nav li:nth-child(3){background: url(../image/nav_bar3.png) no-repeat center 20px; background-size: auto 23px;}
          .nav li:nth-child(4){background: url(../image/nav_bar4.png) no-repeat center 20px; background-size: auto 23px;}
          .nav li:last-child{border-right: none;}

          .box{margin-bottom: 8px; box-shadow: 0 2px 4px 0 rgba(0,0,0,0.15); background: #fff;}
          .box .top{padding: 10px 25px 10px 15px; position: relative; border-bottom: 1px solid #f2f2f2;}
          .top .awardName{font-size: 15px; color: #212121; font-weight: bold;}
          .top .explain{font-size: 13px; color: #999; margin-top: 10px;}
          .top em{position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: url(../image/rt.png) no-repeat center;
          background-size: 7px 11px; width: 7px; height: 11px;}
          .income{display: -webkit-box; display: -webkit-flex; display: flex; border-bottom: 1px solid #f2f2f2;}
          .income .num{font-size: 15px; flex: 1; -webkit-flex:1; -webkit-box-flex:1; border-right: 1px solid #f2f2f2; padding: 15px;}
          .income .num:last-child{border-right: none;}
          .income .num .txt{color: #999; padding-bottom: 10px;}
          .income .num .total{color: #ffb300; font-weight: bold;}
          .chartBox{padding: 10px; display: none;}
          .chartBox .title{padding: 2px 5px 10px 5px; font-size: 15px; color: #999;}
          .chartBox .chart{width: 100%; height: 250px; background: #f2f2f2;}
      </style>
  </head>
  <body>
    <div id="app" v-cloak>
        <header id="header">
            <div class="info">
                <img :src="data.headimgurl" alt="" v-if="data.headimgurl">
                <img src="../image/pic.png" alt="" v-else>
                <span v-if="data.nickname">{{data.nickname}}</span>
                <span v-else>{{data.tel}}</span>
                <em></em>
            </div>
            <div class="assets">现金资产</div>
            <div class="money">
                <div class="num">
                    <em v-if="data.winmoney">{{data.winmoney}}</em>
                    <em v-else>0</em>
                    学分
                </div>
                <button onclick="ApplyFor()">申请提现</button>
            </div>
            <ul class="menu">
                <li onclick="isActive()">
                  <p class="menu_title">已激活产品(套)</p>
                  <p class="num" v-if="Info.count_actvate_product">{{Info.count_actvate_product}}</p>
                  <p class="num" v-else>0</p>
                  <em></em>
                </li>
                <li onclick="goStudentAll()">
                  <p class="menu_title">已激活学员(人)</p>
                  <p class="num" v-if="Info.count_actvate">{{Info.count_actvate}}</p>
                  <p class="num" v-else>0</p>
                  <em></em>
                </li>
                <li>
                  <p class="menu_title">冻结资产(学分)</p>
                  <p class="num" v-if="Info.money">{{Info.money}}</p>
                  <p class="num" v-else>0</p>
                </li>
                <li onclick="goStudent()">
                  <p class="menu_title">待激活学员(人)</p>
                  <p class="num" v-if="Info.count_not_actvate">{{Info.count_not_actvate}}</p>
                  <p class="num" v-else>0</p>
                  <em></em>
                </li>
            </ul>
        </header>
        <ul class="nav">
          <li onclick="creatAct()">发起活动</li>
          <li onclick="goAdmin()">管理活动</li>
          <li onclick="isActive()">产品激活</li>
          <li onclick="inviteToreg()">邀请注册</li>
        </ul>
        <div class="box">
            <div class="top" onclick="goProfit(2)">
                <div class="awardName">参与奖</div>
                <p class="explain">参与奖说明</p>
                <em></em>
            </div>
            <div class="income">
                <div class="num">
                    <p class="txt">总收益(学分)</p>
                    <p class="total total2"></p>
                </div>
                <div class="num">
                    <p class="txt">最近7天收益(学分)</p>
                    <p class="total week2"></p>
                </div>
            </div>
            <div class="chartBox ebox2">
               <div class="title">近1周收益折线图</div>
               <div class="chart" id="chart2"></div>
            </div>
        </div>

        <div class="box">
            <div class="top" onclick="goProfit(1)">
                <div class="awardName">生源奖</div>
                <p class="explain">参与奖说明</p>
                <em></em>
            </div>
            <div class="income">
                <div class="num">
                    <p class="txt">总收益(学分)</p>
                    <p class="total total1"></p>
                </div>
                <div class="num">
                    <p class="txt">最近7天收益(学分)</p>
                    <p class="total week1"></p>
                </div>
            </div>
            <div class="chartBox ebox1">
               <div class="title">近1周收益折线图</div>
               <div class="chart" id="chart1"></div>
            </div>
        </div>

        <div class="box">
            <div class="top" onclick="goProfit(3)">
                <div class="awardName">下线收益</div>
                <p class="explain">参与奖说明</p>
                <em></em>
            </div>
            <div class="income">
                <div class="num">
                    <p class="txt">总收益(学分)</p>
                    <p class="total total3"></p>
                </div>
                <div class="num">
                    <p class="txt">最近7天收益(学分)</p>
                    <p class="total week3"></p>
                </div>
            </div>
            <div class="chartBox ebox3">
               <div class="title">近1周收益折线图</div>
               <div class="chart" id="chart3"></div>
            </div>
        </div>
    </div>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript" src="../script/my.js"></script>
  <script type="text/javascript" src="../script/vue.js"></script>
  <script type="text/javascript" src="../script/echarts.min.js"></script>
  <script type="text/javascript">
      var header = $api.dom('header');
      fixStatusBar_API(header);
      var uid,token;
      apiready = function(){

        uid = $api.getStorage('id');
        token = $api.getStorage('token');
        loading();
        $api.css($api.byId('app'), 'display:none');
        $api.css($api.byId('loading'), 'display:block');
        vm.getUser();
        vm.getInfo();
        getProfit(2);//form收益类型 1:生源奖 2:参与奖 3:下线收益
        getProfit(1);
        getProfit(3);
        $api.css($api.byId('app'), 'display:block');
        $api.css($api.byId('loading'), 'display:none');

        //刷新
        api.setRefreshHeaderInfo({
            loadingImg: 'widget://image/refresh.png',
            bgColor: '#444',
            textColor: '#fff',
            textUp: '释放立即刷新...',
            textLoading: '加载中···',
            showTime: false
        }, function(ret, err) {
            //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
            window.location.reload();
            api.refreshHeaderLoadDone();
        });

      };
      var vm = new Vue({
          el:"#app",
          data:{
              data:[],
              Info:[]
          },
          methods:{
              getUser(){
                  api.ajax({//获取用户基本信息
                      url: serverurl,
                      method: 'get',
                      cache:true,
                      data: {
                          values: {
                              type: '10035',
                               uid: uid,
                             token: token
                          },
                      }
                  },function(ret, err){

                      if (ret.status == '1') {
                          vm.data = ret.data;
                      }else {
                          api.toast({
                              msg: '网络错误',
                              duration: 2000,
                              location: 'middle'
                          });

                      }
                  });
              },

              getInfo(){
                  api.ajax({//个人中心
                      url: serverurl,
                      method: 'get',
                      cache:true,
                      data: {
                          values: {
                              type: '10171',
                               uid: uid,
                             token: token
                          },
                      }
                  },function(ret, err){
                  
                      if (ret) {
                          vm.Info = ret;
                      }else {
                          api.toast({
                              msg: '网络错误',
                              duration: 2000,
                              location: 'bottom'
                          });

                      }

                  });
              }
          }
      })
      // 管理活动
      function goAdmin(){
          api.openWin({
              name: 'Actadmin_title',
              url: './activity/Actadmin_title.html',
              reload:true
          });

      }

      // 发起活动
      function creatAct(){
          api.openWin({
              name: 'creat_Act_title',
              url: './activity/creat_Act_title.html',
              reload:true,
              allowEdit:true
          });
      }

      //去到待激活学员
      function goStudent(){
          api.openWin({
              name: 'stuLis_title',
              url: './setting/stuLis_title.html',
          });
      }

      // 全部学员
      function goStudentAll(){
        api.openWin({
            name: 'stuAll_title',
            url: './setting/stuAll_title.html',
        });
      }

      // 已激活产品
      function isActive(){
        api.openWin({
            name: 'activeProduct_title',
            url: './setting/activeProduct_title.html',
        });
      }

      // 申请提现
      function ApplyFor(){
        api.openWin({
            name: 'widthdraw',
            url: './MyBank/widthdraw.html',
            reload:true,
            allowEdit:true
        });
      }

      // 跳到收益页面
      function goProfit(index){
          api.openWin({
              name: 'profit_title',
              url: './setting/profit_title.html',
              pageParam: {
                  index: index
              }
          });

      }

      // 支教老师收益
      function getProfit(form){//form收益类型 1:生源奖 2:参与奖 3:下线收益
          api.ajax({
              url: serverurl,
              method: 'get',
              cache:true,
              data: {
                  values: {
                       type: '10174',
                      token: token,
                       uid:uid,
                      form:form
                  },
              }
          },function(ret, err){

              if (ret) {

                  if (!ret.status) {
                      $api.text($api.dom('.total'+form),ret.total);
                      $api.text($api.dom('.week'+form),ret.week);

                      if (ret.data) {
                          $api.css($api.dom('.ebox'+form),'display:block');
                          var data = [];
                          var time = [];
                          ret.data.forEach(function(e){
                              data.push(e.count);
                              time.push(e.time);
                          })
                          var myChart = echarts.init(document.getElementById('chart'+form));  // 基于准备好的dom，初始化echarts实例
                          option = {

                                    title: {
                                        text: '近1周收益'
                                    },
                                    tooltip: {
                                        trigger: 'axis'
                                    },

                                    grid: {
                                        left: '3%',
                                        right: '4%',
                                        bottom: '3%',
                                        containLabel: true
                                    },

                                    xAxis: {
                                        type: 'category',
                                        boundaryGap: false,
                                        data: time
                                    },
                                    yAxis: {
                                        type: 'value'
                                    },
                                    series: [
                                        {
                                            name:'参与奖收益',
                                            type:'line',
                                            stack: '总量',
                                            data:data
                                        }
                                    ]
                                };

                          myChart.setOption(option);// 使用刚指定的配置项和数据显示图表。
                      }
                  }else {
                      $api.text($api.dom('.total'+form),0);
                      $api.text($api.dom('.week'+form),0);
                  }
              } else {

                  api.toast({
                      msg: '网络错误',
                      duration: 2000,
                      location: 'middle'
                  });

              }
          });

      }


      // 邀请注册
      function inviteToreg(){
          api.openWin({
              name: 'invite',
              url: './setting/invite.html',
          });

      }
  </script>
  </html>
