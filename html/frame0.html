<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>首页</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../css/style.css"/>
      <link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
      <style>
          header{padding: 0 14px;}
          header{height: 44px; line-height: 44px; box-shadow: 0px 4px 4px 0px rgba(76, 81, 118, 0.15);
            background-color: #fefefe; text-align: center; position: relative;}

          header .title{font-size: 18px; color: #999; line-height: 42px; border-bottom: 2px solid #fefefe;
          margin: 0 15px; -webkit-transition: all .2s;
            transition: all .2s;}
          header .title.on{border-bottom: 2px solid #ffc708; color: #262829; -webkit-transition: all .3s cubic-bezier(.4,0,.2,1);
            transition: all .3s cubic-bezier(.4,0,.2,1);}

          header em{height: 44px;}
          header .scan{background: url(../image/sscan.png) no-repeat center; float: left; width: 19px;
            background-size: 19px 18px;}
          header .search{background: url(../image/search.png) no-repeat center; float: right; width: 18px;
            background-size: 18px;}
          .content{padding: 0 14px; background: #fefefe;}
          .newsAll{padding-top: 10px; padding-bottom: 16px; border-bottom: 1px solid #d2d3d5;}

          .content .title{line-height: 20px; letter-spacing: 1px; font-size: 17px;}
          .content .spe-info{line-height: 20px; letter-spacing: 1px; color: #999;}
          .content .comment{padding-left: 4px; padding-top: 8px; padding-bottom: 6px;}
          .spe-img{width: 100%; max-height: 160px; border-radius: 3px;}
          .new-lt{width: calc(70% - 12px); padding-right: 12px; float: left;}
          .new-lt .title{min-height: 44px;}
          .news-info{margin-top: 16px;}
          .news-info span:nth-child(1){float: left;}
          .news-info span:nth-child(2){float: right;}
          .new-rt{float: left; width: 30%; border-radius: 3px;}
          .new-rt img{width: 100%; max-height: 77px;}

          .circle .top{padding: 14px 13px; font-size: 17px; line-height: 20px; box-shadow: 0px 1px 2px 0px rgba(76, 81, 118, 0.15);
             background-color: #fefefe; display: flex; display: -wekit-flex; align-items: center; -webkit-align-items: center;
             margin-bottom: 10px;}
          .circle .top em{padding: 0px 5px; border: solid 1px #ffc708; letter-spacing: 1px; font-size: 12px;
             border-radius: 2px; color: #ffc708; margin-right: 5px; text-align: center;}
          .circle .act{height: 40px; line-height: 40px; border-bottom: 1px solid #d2d3d5; letter-spacing: 1px;
          color: #999; padding-right: 14px; padding-left: 36px; font-size: 15px; background: url(../image/act.jpg) no-repeat 14px center;
          background-size: 14px; background-color: #fefefe;}
          .act a{float: right; color: #999; display: block; background:url(../image/more.png) no-repeat right center;
            background-size: 16px; min-width: 52px;}

          .swiper-container {
            width: 100%;
            height: 314px;
          }

          .swiper-slide {
            font-size: 18px;
            background: #fefefe;
            padding: 14px;
            box-sizing: border-box;
            width: 85%;

          }

          .swiper-slide.on{
              width: 100%;
          }

          .swiper-slide .act-title{ border-left: 3px solid #46daab; color: #262829; font-size: 17px;
            font-weight: bold; padding-left: 5px; margin-bottom: 10px;}
          .swiper-slide img{width: 100%; max-height: 160px; margin-bottom: 5px;}
          .act-info{line-height: 22px; letter-spacing: 1px; color: #666; font-size: 15px;}

          .actBox{margin-bottom: 10px;}
          .cir-container .cir-box{background: #fefefe; margin-bottom: 10px;}
          .cir-box:last-child{margin-bottom: 0;}
          .cir-container .cir-title{padding: 14px 14px 0 14px; display: -webkit-box;display: -ms-flexbox;display: -webkit-flex;
            display: flex; -webkit-box-align: center;-ms-flex-align: center;-webkit-align-items: center;align-items: center;
           margin-bottom: 8px;}
          .cir-title img{width: 36px; height: 36px; border-radius: 50%;}
          .cir-title .cir-info{margin-left: 12px; -webkit-box-flex: 1;-webkit-flex: 1;flex: 1;}
          .cir-name{font-size: 15px; line-height: 20px;}
          .cir-time{font-size: 12px; line-height: 20px; color: #ced1d5;}
          .cir-title .cir-rt{min-width: 90px; }
          .cir-rt .cir-btn{width: 63px; height: 30px; line-height: 30px; border: solid 1px #dadada; border-radius: 15px;
            font-size: 15px; letter-spacing: 2px; color: #dadada; text-align: center; float: right;}
          .cir-rt .down-arrow{display: inline-block; width: 16px; height: 10px; background: url(../image/down-arrow.png) no-repeat center;
          background-size: contain; margin-left: 10px;}
          .cir-content{font-size: 17px; margin: 0 14px 7px 14px;}
          .cir-navmenu{border-top: 1px solid #f2f2f2;height: 35px; text-align: center;display: -webkit-box;display: -ms-flexbox;display: -webkit-flex;
           display: flex; font-size: 13px; text-align:justify; margin: 0 14px;}
          .cir-navmenu span{-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;overflow-y: auto; display: -webkit-box;display: -ms-flexbox;
            display: -webkit-flex; display: flex; -webkit-box-align: center ;-ms-flex-align: center; -webkit-align-items: center;
            align-items: center; -webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center; }
          .cir-navmenu span em{width: 20px; height: 30px; }
          .cir-navmenu span i{margin-left: 3px; color: #999;}
          .cir-navmenu span:nth-child(3) i{margin-left: 4px;}
          .cir-navmenu span:nth-child(1) em{background: url(../image/love.png) no-repeat center 1px; background-size: auto 20px;}
          .cir-navmenu span:nth-child(2) em{background: url(../image/comment.png) no-repeat center; background-size: auto 20px;}
          .cir-navmenu span:nth-child(3) em{background: url(../image/share.png) no-repeat center; background-size: auto 20px;}
          .cir-navmenu span:nth-child(1) em.on{background: url(../image/love1.png) no-repeat center 1px; background-size: auto 20px;}

          /*九宫格*/
          .cell {padding:0 14px;max-width: 210px;max-height: 210px;overflow: hidden;padding-bottom: 10px;}
          .cell img { width: 100%; height: 100%;}
          .cell9 {padding:0 7px;width: calc(100% - 14px);overflow: hidden;}
          .cell9 .item { width: calc(33.33% - 14px); float: left; margin: 0 7px 14px 7px; position: relative; }
          .cell9.cell4 .item {width: calc(50% - 14px);}
          .cell9 .item:before {content: "";display: inline-block;padding-bottom: 100%;width: 0.1px;vertical-align: middle;}
          .cell9 .item img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

          .bad-video{margin:0 14px 14px 14px; position: relative; height: 200px;}
          .videoPlay{position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); height: 58px;}
          .video{ width:100%; height:100%;}
          .video-num{color: #fff; font-size: 13px; letter-spacing: 2px; position: absolute; right: 10px; bottom: 13px;}

      </style>
  </head>
  <body>
      <div id="wrap" v-cloak>
          <header>
              <a class="title" :class="{on:changeColor == index}" href="javascript:;" v-for="(item,index) in tabData" tapmode @click="switchTab(index)">
                {{item.tabName}}
              </a>
              <em class="scan" tapmode onclick="ScanCode()"></em>
              <em class="search" tapmode onclick="openWin('search','./search.html','')"></em>
          </header>
          <div id="main">
              <div class="container">
                  <!-- 新鲜事 -->
                  <div class="content" v-if="changeColor == 0 && !data.status">
                    <div v-for="v in data">
                      <div class="newsAll" tapmode @click="goDetail(v.id,1)" v-if="v.type == 1">
                          <div class="title more">{{v.title}}</div>
                          <div class="spe-info">
                              <span>{{v.time | getInfoDate}}</span>
                              <span class="comment">{{v.count}}评论</span>
                          </div>
                          <img class="spe-img" src="../image/defalut.png" :srcs="v.surface_plot" alt="新闻图片">

                      </div>
                      <div class="newsAll clearfix" tapmode @click="goDetail(v.id,1)" v-else>
                          <div class="new-lt">
                              <div class="title more">{{v.title}}</div>
                              <div class="news-info clearfix">
                                  <span class="spe-info">{{v.time | getInfoDate}}</span>
                                  <span class="spe-info">{{v.count}}评论</span>
                              </div>
                          </div>
                          <div class="new-rt">
                              <img src="../image/defalut.png" :srcs="v.surface_plot+'?x-oss-process=image/resize,m_fill,h_210,w_210'" alt="新闻图片" class="new-img">
                          </div>
                      </div>
                    </div>
                  </div>

                  <!-- 学客圈 -->
                  <div class="circle" v-else-if="changeColor == 1 && circledata && acts">
                      <div class="top" v-if="grooms">
                          <em>官推</em>
                          {{grooms.title}}>>
                      </div>
                      <div class="actBox" v-if="!acts.status">
                          <div class="act">
                              学令牌活动
                              <!-- <a href="javascript:;" tapmode onclick="getUser()">更多</a> -->
                          </div>

                          <!-- Swiper -->
                          <div class="swiper-container">
                            <div class="swiper-wrapper">
                              <div class="swiper-slide" :class="{on:acts.length == 1}" v-for="v in acts" tapmode @click="goDetail(v.id,2)">
                                  <div class="act-title more">
                                    {{v.title}}
                                  </div>
                                  <img src="../image/defalut.png" :srcs="v.actimgurl+'?x-oss-process=image/resize,p_50'" alt="活动图片" class="act-img">
                                  <p class="act-info more3" v-html="v.content"></p>
                              </div>
                            </div>
                          </div>
                      </div>
                      <!-- 用户发表的学科圈 -->
                      <div class="cir-container" v-if="circledata">

                          <div class="cir-box" v-for="v in circledata">
                              <div class="cir-title">
                                  <img src="../image/pic.png" :srcs="v.headimgurl+'?x-oss-process=image/resize,m_fill,h_36,w_36'" alt="人头像" v-if="v.headimgurl" tapmode @click="goDetail(v.uid,3)">
                                  <img src="../image/pic.png" alt="人头像" v-else tapmode @click="goDetail(v.uid,3)">
                                  <div class="cir-info">
                                      <p class="cir-name">{{v.nickname}}</p>
                                      <p class="cir-time">{{v.last_reply_at | getInfoDate}}</p>
                                  </div>
                                  <div class="cir-rt" v-if="v.uid != id">
                                      <!-- is_follow是否关注 1 已经关注 0 没有关注 -->
                                      <span class="cir-btn" tapmode @click="follow(v,0)" v-if="v.is_follow == '1'">已关注</span>
                                      <span class="cir-btn" tapmode @click="follow(v,1)" v-else>+关注</span>
                                      <!-- <span class="down-arrow"></span> -->
                                  </div>
                              </div>
                              <div class="cir-content more3" v-if="v.content" tapmode @click="goDetail(v.id,4)">
                                  {{v.content}}
                              </div>

                              <div v-if="v.thumb">
                                  <!-- 1张图片 -->
                                  <ul class="cell clearfix" v-if="v.thumb.length == 1">
                                       <li class="item" v-for="(item,index) in v.thumb">
                                          <img class="cir-img" src="../image/defalut.png" :srcs="item+'?x-oss-process=image/resize,m_fill,h_180,w_180'" alt="动态图" @click="viewPicture(v.thumb,index)">
                                       </li>
                                  </ul>
                                  <!-- 4宫格图片 -->
                                  <ul class="cell9 cell4 clearfix" v-else-if="v.thumb.length == 4">
                                       <li class="item" v-for="(item,index) in v.thumb">
                                          <img class="cir-img" src="../image/defalut.png" :srcs="item+'?x-oss-process=image/resize,m_fill,h_180,w_180'" alt="动态图" @click="viewPicture(v.thumb,index)">
                                       </li>

                                  </ul>

                                  <!-- 9宫格图片 -->
                                  <ul class="cell9 clearfix" v-else>
                                       <li class="item" v-for="(item,index) in v.thumb">
                                          <img class="cir-img" src="../image/defalut.png" :srcs="item+'?x-oss-process=image/resize,m_fill,h_180,w_180'" alt="动态图" @click="viewPicture(v.thumb,index)">
                                       </li>

                                  </ul>
                              </div>

                              <!-- 视频 -->
                              <!-- <div class="bad-video">
                                <video class="video" poster="../image/img.jpg" webkit-playsinline style="object-fit:fill;">
                                  <source src="http://www.runoob.com/try/demo_source/movie.mp4" type="video/mp4">
                                  您的浏览器不支持 HTML5 video 标签。
                                </video>
                                <img class="videoPlay" src="../image/play.png" alt="播放按钮" tapmode onclick="videoPlay()">
                                <span class="video-num">591次播放</span>
                              </div> -->

                              <div class="cir-navmenu">
                                  <!--  is_like是否点赞 1 已经点赞 0 没有点赞 -->
                                  <span tapmode @click="giveLike(v)"><em :class="{on:v.is_like == 1}"></em><i>{{v.like}}</i></span>
                                  <span tapmode @click="goDetail(v.id,4)"><em></em><i>{{v.rew}}</i></span>
                                  <span tapmode @click="Share(v.content,v.id)"><em></em><i>{{v.smit}}</i></span>
                              </div>
                          </div>


                      </div>

                  </div>

                  <!-- 没有数据 -->
                  <div class="no-data" v-else>
            					 <img src="../image/ndata.png" alt="没数据图片">
            					 <p>抱歉，没有数据~</p>
            			</div>
              </div>
          </div>
      </div>

  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript" src="../script/my.js"></script>
  <script type="text/javascript" src="../script/vue.js"></script>
  <script type="text/javascript" src="../script/swiper.min.js"></script>
  <script type="text/javascript" src="../script/date.js"></script>

  <script type="text/javascript">
      var token,id;
      var page = 1;

      apiready = function(){
          SetStatusBar('#main','dark','#fefefe');//设置状态栏my.js
          api.parseTapmode();//解析元素 tapmode 属性，优化点击事件处理
          token = api.getPrefs({
              sync: true,
              key: 'token'
          });
          id = api.getPrefs({
              sync: true,
              key: 'id'
          });
          vm.switchTab(0);

          // 监听学客圈变化
          api.addEventListener({
              name: 'circle'
          }, function(ret, err){
              if( ret ){

                   vm.getCircle();
              }else{
                   console.log( JSON.stringify( err ) );
              }
          });
          // 监听新鲜事变化
          api.addEventListener({
              name: 'news'
          }, function(ret, err){
              if( ret ){

                   vm.getNews(1);
              }else{
                   console.log( JSON.stringify( err ) );
              }
          });

      }

      var vm = new Vue({
          el:'#wrap',
          data:{
              data:[],
              grooms:'',
              acts:[],
              circledata:[],
              loadata:true, // 设置一个开关来避免重负请求数据
              updata:false,
              changeColor:0,
              id:'',
              tabData:[
                  {tabName:'新鲜事'},
                  {tabName:'学客圈'}
              ],
          },
          filters: {
              getInfoDate: function getInfoDate(time) {
                  return getDate(time);
              }
          },
          methods:{

            goDetail:function(id,index){
                if (index == 1) {
                    // 跳到新鲜事详情页
                    openWin('circleDetail1','./circle/circleDetail1.html',{newid:id});
                }else if (index == 2) {
                    // 打开活动详情页
                    openWin('actDetail','./active/actDetail.html',{actid:id});
                }else if (index == 3) {
                    // 打开主页
                    openWin('MyIndex','./mine/MyIndex.html',{id:id});
                }else {
                    // 学客圈详情页
                    openWin('circleDetail2','./circle/circleDetail2.html',{cirid:id});
                }

            },

            switchTab:function switchTab(index){
                  vm.changeColor = index;
                  if (index == 1) {

                     vm.getgroom();
                     vm.getActs();
                     vm.getCircle();

                     vm.data = [];
                     page = 1;

                  }else {

                     vm.getNews(page);
                     api.addEventListener({
                         name:'scrolltobottom',
                         extra:{
                             threshold:400            //设置距离底部多少距离时触发，默认值为0，数字类型
                         }
                     }, function(ret, err){
                         vm.updata = true;

                         if(vm.changeColor == 0){
                           if (vm.loadata == true) {
                               vm.loadata = false;
                               vm.getNews(page+=1);
                           }
                         }
                     });
                  }
            },
            // 显示大图
            viewPicture: function viewPicture(data, index) {
                if (data) {
                    var url = [];
                    data.forEach(function (ret) {
                        url.push(ret);
                    });
                    var imageBrowser = api.require('imageBrowser');
                    imageBrowser.openImages({
                        imageUrls: url,
                        showList:false,
                        activeIndex: index
                    });
                }
            },
            //获取新鲜事
            getNews:function getNews(page){
                showProgress('努力加载中','请稍后···');
                api.ajax({
                    url: serverurl,
                    method: 'get',
                    cache:true,
                    data: {
                        values: {
                            type: '10064',
                           token: token,
                           uid:id,
                           limit: page
                        },
                    }
                },function(ret, err){
                    api.hideProgress();

                    if (ret) {
                      if (ret.status == '5') {

                         ExitLogin();
                      }else if (ret.status == '0') {
                         msg('没有更多数据');
                      } else {
                          if (vm.updata == true) {
                              ret.forEach(function(item){
                                  vm.data.push(item);
                              })
                              vm.loadata = true;

                          }else {
                              vm.data = ret;
                          }
                          vm.$nextTick(function () {
                            // DOM 现在更新了
                            // `this` 绑定到当前实例
                            imageCache('.new-img');
                            imageCache('.spe-img');
                          })

                      }
                    }else {
                        msg('网络错误');
                    }
                });
            },
            // 获取官方推荐
            getgroom:function getgroom(){
                showProgress('努力加载中','请稍后···');
                api.ajax({
                    url: serverurl,
                    method: 'get',
                    data: {
                        values: {
                            type: '10087',
                           token: token,
                             uid:id
                        },
                    }
                },function(ret, err){
                    api.hideProgress();

                    if (ret) {
                        if (ret.status == '5') {

                           ExitLogin();
                        }else{
                           vm.grooms = ret;
                        };
                    }else {
                        msg('网络错误');
                    }
                });
            },
            // 获取活动列表
            getActs:function getActs(){
                showProgress('努力加载中','请稍后···');
                api.ajax({
                    url: serverurl,
                    method: 'get',
                    cache:true,
                    data: {
                        values: {
                            type: '10066',
                           token: token,
                             uid:id,
                            form:'2'//活动类型 1 个人活动 2官方活动
                        },
                    }
                },function(ret, err){
                    api.hideProgress();

                    if (ret) {
                        if (ret.status == '5') {

                           ExitLogin();
                        }else{
                           vm.acts = ret;
                           vm.$nextTick(function () {
                             swiper();
                             // DOM 现在更新了
                             // `this` 绑定到当前实例
                             imageCache('.act-img');

                           })
                        };
                    }else {
                        msg('网络错误');
                    }
                });
            },
            // 学客圈列表
            getCircle:function getCircle(){
                showProgress('努力加载中','请稍后···');

                api.ajax({
                    url: serverurl,
                    method: 'get',
                    cache:true,
                    data: {
                        values: {
                            type: '10115',
                           token: token,
                           uid:id
                        },
                    }
                },function(ret, err){
                    api.hideProgress();
                    vm.id = id;
                    if (ret) {
                      if (ret.status == '5') {

                         ExitLogin();
                      }else if (ret.status == '0') {
                         msg('没有更多数据');
                      } else {
                         vm.circledata = ret.data;
                         vm.$nextTick(function () {
                           // DOM 现在更新了
                           // `this` 绑定到当前实例
                           imageCache('.cir-img');
                           imageCache('.pimg');
                         })
                      }
                    }else {
                        msg('网络错误');
                    }
                });
            },
            //用户关注
            follow:function follow(item,status){
                var time = Math.round(new Date().getTime()/1000);
                showProgress('努力加载中','请稍后···');
                api.ajax({
                    url: serverurl,
                    method: 'get',
                    data: {
                        values: {
                            type: '10072',
                             uid: id,
                           token:token,
                          follower_id: item.uid,
                            time: time,
                          status: status//关注 ： 1 取消关注 ：0
                        },
                    }
                },function(ret, err){
                    api.hideProgress();

                    if (ret) {
                        if (ret.status == '5') {
                            ExitLogin();
                        }else if(ret.status == '0'){
                            msg('操作失败');

                        }else {
                            // <!-- is_follow是否关注 1 已经关注 0 没有关注 -->
                            if (status == 1) {//关注 ： 1 取消关注 ：0
                               item.is_follow = 1;
                            }else {
                               item.is_follow = 0;
                            }

                        }
                    }else {
                        msg('网络错误');

                    }
                });
            },

            //学客圈点赞
            giveLike:function giveLike(item){
                showProgress('努力加载中','请稍后···');
                api.ajax({
                    url: serverurl,
                    method: 'get',
                    data: {
                        values: {
                            type: '10119',
                             uid: id,
                           token:token,
                              id:item.id
                        },
                    }
                },function(ret, err){
                    api.hideProgress();
                    if (ret) {
                        if (ret.status == '5') {
                            ExitLogin();
                        }else {
                            // state:1点赞成功，再次点取消点赞 返回0
                            if (ret.status == 1) {
                                //  <!--  is_like是否点赞 1 已经点赞 0 没有点赞 -->
                                item.is_like = 1;
                            }else {
                                item.is_like = 0;
                            }
                            item.like = ret.count;
                        }
                    }else {
                        msg('网络错误');

                    }
                });
            },

            Share: function Share(content, circle_id) {

                var dialogBox = api.require('dialogBox');
                dialogBox.actionMenu({
                    rect: {
                        h: 150
                    },
                    texts: {
                        cancel: '取消'
                    },
                    items: [{
                        text: '朋友圈',
                        icon: 'widget://image/share2.png'
                    }, {
                        text: '微信好友',
                        icon: 'widget://image/share1.png'
                    }],
                    styles: {
                        bg: '#FFF',
                        column: 3,
                        itemText: {
                            color: '#000',
                            size: 14,
                            marginT: 8
                        },
                        itemIcon: {
                            size: 40
                        },
                        cancel: {
                            bg: 'fs://icon.png',
                            color: '#000',
                            h: 44,
                            size: 16
                        }
                    },
                    tapClose: true
                }, function (ret) {

                    if (ret.eventType == 'cancel') {
                        dialogBox.close({
                            dialogName: 'actionMenu'
                        });
                    } else {
                        dialogBox.close({
                            dialogName: 'actionMenu'
                        });
                        if (ret.index == 0) {
                            weiShare('timeline', content, content, circle_id);
                        } else if (ret.index == '1') {
                            weiShare('session', '学客圈', content, circle_id);
                        }
                    }
                });
            }


          },

      })

      // 微信分享网页
      function weiShare(scene,title,content,circle_id){
          var contentUrl = 'https://wechat.123win.com.cn/xlp/circle/circleDetail2.html?circle_id='+circle_id+'&token='+token+'&uid='+id;
          var wx = api.require('wx');
          wx.isInstalled(function(ret, err) {//判断当前设备是否已经安装微信
              if (ret.installed) {

                  wx.shareWebpage({
                      apiKey: '',
                      scene: scene,
                      title: title,
                      description: content,
                      thumb: 'widget://icon/icon2.png',
                      contentUrl: contentUrl
                  }, function(ret, err) {

                      if (ret.status) {

                          msg('分享成功');
                          sharenum(circle_id);

                      } else {

                          console.log(err.code);

                      }
                  });
              } else {

                  msg('当前设备未安装微信客户端');

              }
          });

      }

      // swiper
      function swiper(){
          var swiper = new Swiper('.swiper-container', {
            initialSlide :0,//设定初始化时slide的索引。
            slidesPerView: 'auto',
            spaceBetween: 6,
            observer:true, //修改swiper自己或子元素时，自动初始化swiper
            observeParents:true,//修改swiper的父元素时，自动初始化swiper

          });

      }

      // 打开h5视频播放器
      function videoPlay(){
          var video = $api.prev($api.dom('.videoPlay'));
          $api.css($api.dom('.videoPlay'), 'display:none');
          $api.css($api.dom('.video-num'), 'display:none');

          video.play();
          $api.attr(video, 'controls', 'true');


      }

      // 扫描二维码
      function ScanCode(){

        var FNScanner = api.require('FNScanner');
        FNScanner.openScanner({
            autorotation: true
        }, function(ret, err) {

            if (ret) {
                if (ret.eventType == 'success') {
                    if (ret.content.indexOf("xly1.cn") >= 0) {
                        var key = ret.content.substr(0,4);//提取字符串前四位
                        api.sendEvent({
                            name: 'scan',
                            extra: {
                                key: key
                            }
                        });

                    }else {
                        msg('二维码不正确');
                    }
                }else if (ret.eventType == 'fail') {
                    msg('扫描失败');
                }
            } else {
                msg(err);
            }
        });
      }

      // 学客圈转发
      function sharenum(ccl_id){
          var time = Math.round(new Date().getTime()/1000);
          api.ajax({
              url: serverurl,
              method: 'get',
              data: {
                  values: {
                      type: '10089',
                      uid:id,
                      token: token,
                      ccl_id: ccl_id,
                       time: time
                  },
              }
          },function(ret, err){
              if (ret) {
                if (ret.status == '5') {
                    ExitLogin();
                }else {
                    vm.getCircle();
                }

              } else {

                  msg('网络错误');
              }
          });

      }
  </script>
  </html>
