<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
      <title>消息</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/loading.css"/>
      <style>
        header{height: 50px; line-height: 50px; background: #ffb300; color: #fff; font-size: 18px; position: relative;}
        header em{width: 50px; height: 50px; background: url(../../image/back.png) no-repeat center;
          background-size: 20px; float: left;}
        header span{float: right; margin-right: 15px;}

        .newsLis{background: #fff;}
        .newsLis li{padding: 10px 15px; border-bottom: 1px solid #f2f2f2; display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;
        -webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;}
        .img{width: 44px; height: 44px; border-radius: 50%; margin-right: 5px;}
        .newsLis li .txt{width: calc(100% - 49px);}
        .txt p{ line-height: 22px; }
        .txt .name{position: relative; padding-right: 60px; width: calc(100% - 60px);}
        .txt .name .nickname{font-size: 15px; color: #212121;}
        .name .time{font-size: 13px; color: #757575; position: absolute; right: 0;}
        .txt .content{font-size: 13px; color: #757575;}
        .txt .fr{width: 50px; height: 44px;}
        .love{width: 15px; height: 22px; background: url(../../image/love.png) no-repeat center; background-size: 15px;}
        .noNews{padding: 25px; text-align: center; font-size: 16px;}
      </style>
  </head>
  <body>
    <div id="wrap">
        <header>
            <em onclick="go_back()"></em>
            消息
            <span onclick="clearNews()">清空</span>
        </header>
        <div id="main" v-cloak>
            <ul class="newsLis" v-if="like || rew">
                <li v-for="v in like" v-if="like" @click="goDetail(v.id)">
                    <img class="img" :src="v.headimgurl" alt="" v-if="v.headimgurl">
                    <img class="img" src="../../image/pic3.png" alt="" v-else>
                    <div class="txt">
                        <p class="name single">
                          {{v.nickname}}
                          <span class="time">{{v.time | getInfoDate}}</span>
                        </p>
                        <!-- 点赞 -->
                        <p class="love" v-if="v.status == 1"></p>
                    </div>
                </li>
                <li v-for="vv in rew" v-if="rew" @click="goDetail(vv.id)">
                    <img class="img" :src="vv.headimgurl" alt="" v-if="vv.headimgurl">
                    <img class="img" src="../../image/pic3.png" alt="" v-else>
                    <div class="txt">
                        <p class="name single">
                          {{vv.nickname}}
                          <span class="time">{{vv.time | getInfoDate}}</span>
                        </p>
                        <!-- 回复、评论 -->
                        <p class="single content">{{vv.content}}</p>
                    </div>
                </li>
            </ul>

            <div class="noNews" v-else>暂无消息~</div>
        </div>

    </div>

  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/my.js"></script>
  <script type="text/javascript" src="../../script/vue.js"></script>
  <script type="text/javascript" src="../../script/date.js"></script>

  <script type="text/javascript">
      var header = $api.dom('header');
      fixStatusBar_API(header);
      var uid,token;
      apiready = function(){
        loading();
        uid = $api.getStorage('id');
        token = $api.getStorage('token');

        vm.getReplyUser();
      };

      var vm = new Vue({
          el:'#main',
          data:{
              rew:[],
              like:[]
          },
          filters:{
              getInfoDate(time) {
                  return getDate(time);
              }
          },
          methods:{
              getReplyUser(){//用户收到的回复

                  $api.css($api.byId('loading'), 'display:block');

                  api.ajax({
                      url: serverurl,
                      method: 'get',
                      cache:true,
                      data: {
                          values: {
                              type: '10134',
                              token: token,
                              uid:uid
                          },
                      }
                  },function(ret, err){

                      $api.css($api.byId('loading'), 'display:none');

                      if (ret) {

                          vm.rew = ret.rew;
                          vm.like = ret.like;

                      } else {

                          api.toast({
                              msg: '网络错误',
                              duration: 2000,
                              location: 'bottom'
                          });

                      }
                  });
              },

              goDetail(id){

                  api.openWin({
                      name: 'circleDetail',
                      url: './circleDetail.html',
                      pageParam: {
                          circle_id: id
                      }
                  });

              }
          }
      })

      // 清空消息
      function clearNews(){
          $api.css($api.byId('loading'), 'display:block');

          if (vm.rew) {
            var idArr = [];
            vm.rew.forEach(function(item){
                idArr.push(item.id);
            })
          }
          api.ajax({
              url: serverurl,
              method: 'get',
              data: {
                  values: {
                      type: '10146',
                      token:token,
                      uid:uid,
                      id:idArr
                  },
              }
          },function(ret, err){
              $api.css($api.byId('loading'), 'display:none');
            
              if (ret) {

                  if (ret.status == '1') {
                      vm.getReplyUser();
                  }else {
                      api.toast({
                          msg: '网络错误',
                          duration: 2000,
                          location: 'bottom'
                      });
                  }
              } else {
                  api.toast({
                      msg: '网络错误',
                      duration: 2000,
                      location: 'bottom'
                  });

              }
          });

      }
  </script>
  </html>
